{
    "imports": [
        "github.com/project-flogo/flow",
        "github.com/project-flogo/contrib/activity/actreturn",
        "github.com/project-flogo/contrib/trigger/rest",
        "github.com/project-flogo/contrib/function/string",
        "github.com/project-flogo/contrib/function/coerce",
        "github.com/project-flogo/contrib/function/array",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/log",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/tablemutate",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/tablequery",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/mapping",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/httpclient",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/jsondeserializer",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/trigger/httpredirect",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/function/f1"
    ],
    "name": "ServiceLocator",
    "description": "",
    "version": "1.0.0",
    "type": "flogo:app",
    "appModel": "1.1.1",
    "feVersion": "2.9.0",
    "triggers": [
        {
            "ref": "#rest",
            "name": "tibco-wi-rest",
            "description": "Simple REST Trigger",
            "settings": {
                "port": 10080,
                "enableTLS": false,
                "certFile": "",
                "keyFile": ""
            },
            "id": "ReceiveHTTPMessage",
            "handlers": [
                {
                    "description": "",
                    "settings": {
                        "method": "POST",
                        "path": "/f1/locator/register/:service"
                    },
                    "action": {
                        "ref": "github.com/project-flogo/flow",
                        "settings": {
                            "flowURI": "res://flow:RegisterService"
                        },
                        "input": {
                            "ID": "=$.content.ID",
                            "URL": "=$.content.URL",
                            "Type": "=$.pathParams.service",
                            "Location": "=$.content.Location",
                            "Properties": "=$.content.Properties",
                            "Endpoint": "=$.content.Endpoint"
                        },
                        "output": {
                            "data": {
                                "mapping": {
                                    "Response": "=$.Response"
                                }
                            }
                        }
                    },
                    "reply": {
                        "code": 200,
                        "message": {}
                    },
                    "name": "RegisterService"
                },
                {
                    "description": "",
                    "settings": {
                        "method": "POST",
                        "path": "/f1/locator/unregister/:service"
                    },
                    "action": {
                        "ref": "github.com/project-flogo/flow",
                        "settings": {
                            "flowURI": "res://flow:UnregisterService"
                        },
                        "input": {
                            "ID": "=$.content.ID",
                            "Type": "=$.pathParams.service",
                            "Location": "=$.content.Location"
                        },
                        "output": {
                            "data": {
                                "mapping": {
                                    "Response": "=$.Response"
                                }
                            },
                            "code": 200
                        }
                    },
                    "reply": {
                        "code": 200,
                        "message": {}
                    },
                    "name": "UnregisterService"
                },
                {
                    "description": "",
                    "settings": {
                        "method": "GET",
                        "path": "/f1/locator/list/:service"
                    },
                    "action": {
                        "ref": "github.com/project-flogo/flow",
                        "settings": {
                            "flowURI": "res://flow:ListServices"
                        },
                        "input": {
                            "Type": "=$.pathParams.service"
                        },
                        "output": {
                            "data": {
                                "mapping": {
                                    "Response": "=$.Response"
                                }
                            }
                        }
                    },
                    "reply": {
                        "code": 200,
                        "message": {}
                    },
                    "name": "ListServices"
                },
                {
                    "description": "",
                    "settings": {
                        "method": "GET",
                        "path": "/f1/locator/locate/:ServiceType/:serviceID"
                    },
                    "action": {
                        "ref": "github.com/project-flogo/flow",
                        "settings": {
                            "flowURI": "res://flow:LocateService"
                        },
                        "input": {
                            "ServiceID": "=$.pathParams.serviceID",
                            "ServiceType": "=$.pathParams.ServiceType"
                        },
                        "output": {
                            "code": 200,
                            "data": {
                                "mapping": {
                                    "Code": "=$.Code",
                                    "Response": "=$.Response"
                                }
                            }
                        }
                    },
                    "reply": {
                        "code": 200,
                        "message": {}
                    },
                    "name": "LocateService"
                },
                {
                    "description": "",
                    "settings": {
                        "method": "GET",
                        "path": "/f1/metadata/:name"
                    },
                    "action": {
                        "ref": "github.com/project-flogo/flow",
                        "settings": {
                            "flowURI": "res://flow:GetMetadata"
                        },
                        "input": {
                            "Name": "=$.pathParams.name"
                        },
                        "output": {
                            "data": {
                                "mapping": {
                                    "Value": "=$.Value",
                                    "Name": "=$.Name"
                                }
                            }
                        }
                    },
                    "reply": {
                        "code": 200,
                        "message": {}
                    },
                    "name": "GetMetadata"
                },
                {
                    "description": "",
                    "settings": {
                        "method": "GET",
                        "path": "/f1/locator/locationservices/:location/:service"
                    },
                    "action": {
                        "ref": "github.com/project-flogo/flow",
                        "settings": {
                            "flowURI": "res://flow:ListServicesDetailsByLocation"
                        },
                        "input": {
                            "Type": "=$.pathParams.service",
                            "Location": "=$.pathParams.location"
                        },
                        "output": {
                            "data": {
                                "mapping": {
                                    "Response": "=$.Response"
                                }
                            }
                        }
                    },
                    "reply": {
                        "code": 200,
                        "message": {}
                    },
                    "name": "ListServicesDetailsByLocation"
                }
			]
        },
        {
            "ref": "#httpredirect",
            "name": "httpredirect",
            "description": "This trigger redirects HTTP request",
            "settings": {
                "Port": "10081"
            },
            "id": "HTTPRedirect",
            "handlers": [
                {
                    "description": "",
                    "settings": {
                        "Path": "/"
                    },
                    "action": {
                        "ref": "github.com/project-flogo/flow",
                        "settings": {
                            "flowURI": "res://flow:HTTPRedirect"
                        },
                        "input": {
                            "RequestURL": "=$.RequestURL"
                        },
                        "output": {
                            "data": {
                                "mapping": {
                                    "RedirectURL": "=$.RedirectURL"
                                }
                            }
                        }
                    },
                    "reply": {
                        "code": 200
                    },
                    "schemas": {
                        "reply": {
                            "data": {
                                "type": "json",
                                "value": "{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"RedirectURL\":{\"type\":\"string\"}}}"
                            }
                        }
                    },
                    "name": "HTTPRedirect"
                }
            ]
        }
    ],
    "resources": [
        {
            "id": "flow:RegisterService",
            "data": {
                "name": "RegisterService",
                "description": "",
                "links": [
                    {
                        "id": 1,
                        "from": "LogRegisterService",
                        "to": "TableMutate",
                        "type": "default"
                    },
                    {
                        "id": 2,
                        "from": "TableMutate",
                        "to": "Log",
                        "type": "default"
                    },
                    {
                        "id": 3,
                        "from": "Log",
                        "to": "Return",
                        "type": "default"
                    }
                ],
                "tasks": [
                    {
                        "id": "LogRegisterService",
                        "name": "LogRegisterService",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"^^^^^^ Register Service ^^^^^^ ID : \", $flow.ID, \", Type : \", $flow.Type, \", Location : \", $flow.Location, \", URL : \", $flow.URL, \", Properties : \", coerce.toString($flow.Properties), \", Endpoint : \", coerce.toString($flow.Endpoint))"
                            }
                        }
                    },
                    {
                        "id": "TableMutate",
                        "name": "TableMutate",
                        "description": "A simple activity for upserting/deleting data to/from table",
                        "activity": {
                            "ref": "#tablemutate",
                            "settings": {
                                "Table": {
                                    "id": "c6215040-4aff-11eb-9ffb-8db6499bd1d7",
                                    "type": "flogo:connector",
                                    "version": "1.0.0",
                                    "name": "tibco-simple-table",
                                    "hashTags": [],
                                    "inputMappings": {},
                                    "outputMappings": {},
                                    "iteratorMappings": {},
                                    "title": "Simple Table",
                                    "description": "This is URL file reader",
                                    "ref": "github.com/TIBCOSoftware/labs-lightcrane-contrib/connector/simpletable",
                                    "settings": [
                                        {
                                            "name": "name",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Name",
                                                "description": "Name of the table instance"
                                            },
                                            "value": "Services"
                                        },
                                        {
                                            "name": "description",
                                            "type": "string",
                                            "display": {
                                                "name": "Description",
                                                "description": "A simple table for storing tuple"
                                            },
                                            "value": ""
                                        },
										{
											"name": "properties",
											"type": "string",
											"required": true,
											"display": {
												"name": "Properties",
												"description": "Properties of the table"
											},
											"value": "=$property[\"System.Table.Properties\"]"
										},
                                        {
                                            "name": "schema",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Schema",
                                                "description": "Schema of the table"
                                            },
                                            "value": "[{\"Name\":\"ServiceID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"ServiceType\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"LocationID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"URL\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Properties\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Endpoint\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"}]"
                                        }
                                    ],
                                    "outputs": [],
                                    "inputs": [],
                                    "handler": {
                                        "settings": []
                                    },
                                    "reply": [],
                                    "s3Prefix": "flogo",
                                    "key": "flogo/GraphBuilder_Tools/connector/simpletable/connector.json",
                                    "display": {
                                        "description": "This is URL file reader",
                                        "category": "GraphBuilder_Tools",
                                        "visible": true,
                                        "smallIcon": "simpletable.png"
                                    },
                                    "actions": [
                                        {
                                            "name": "create",
                                            "display": {
                                                "name": "Create",
                                                "readonly": false,
                                                "valid": true,
                                                "visible": true
                                            }
                                        }
                                    ],
                                    "feature": {},
                                    "loopType": "none",
                                    "loopSettings": [],
                                    "retrySettings": [],
                                    "propertyMap": {},
                                    "keyfield": "name",
                                    "schemaMap": {},
                                    "iteratorAccumulate": false,
                                    "isValid": true,
                                    "lastUpdatedTime": 1637691762447,
                                    "user": "flogo",
                                    "connectorName": "Services",
                                    "connectorDescription": " "
                                },
                                "Method": "upsert"
                            },
                            "input": {
                                "Mapping": {
                                    "mapping": {
                                        "ServiceID": "=$flow.ID",
                                        "ServiceType": "=$flow.Type",
                                        "LocationID": "=$flow.Location",
                                        "URL": "=$flow.URL",
                                        "Properties": "=f1.ternary(null!=$flow.Properties, $flow.Properties, f1.json2object(\"{}\"))",
                                        "Endpoint": "=f1.ternary(null!=$flow.Endpoint, $flow.Endpoint, f1.json2object(\"{}\"))"
                                    }
                                }
                            },
                            "output": {
                                "Exists": false
                            }
                        }
                    },
                    {
                        "id": "Log",
                        "name": "Log",
                        "description": "Logs a message",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"^^^^^^ After Register Service ^^^^^^ Data : \", coerce.toString($activity[TableMutate].Data))"
                            }
                        }
                    },
                    {
                        "id": "Return",
                        "name": "Return",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Response": {
                                        "mapping": {
                                            "ID": "=$activity[TableMutate].Data.New.ServiceID",
                                            "Type": "=$activity[TableMutate].Data.New.ServiceType",
                                            "URL": "=$activity[TableMutate].Data.New.URL",
                                            "Properties": "=$activity[TableMutate].Data.New.Properties",
                                            "Location": "=$activity[TableMutate].Data.New.LocationID",
                                            "Endpoint": "=$flow.Endpoint"
                                        }
                                    }
                                }
                            }
                        }
                    }
                ],
                "metadata": {
                    "input": [
                        {
                            "name": "ID",
                            "type": "string"
                        },
                        {
                            "name": "Type",
                            "type": "string"
                        },
                        {
                            "name": "Location",
                            "type": "string"
                        },
                        {
                            "name": "URL",
                            "type": "string"
                        },
                        {
                            "name": "Properties",
                            "type": "object"
                        },
                        {
                            "name": "Endpoint",
                            "type": "object"
                        }
                    ],
                    "output": [
                        {
                            "name": "Response",
                            "type": "object",
                            "schema": {
                                "type": "json",
                                "value": "{\"ID\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"},\"Location\":{\"type\":\"string\"},\"URL\":{\"type\":\"string\"},\"Properties\":{\"type\":\"object\",\"properties\":{}},\"Endpoint\":{\"type\":\"object\",\"properties\":{}}}"
                            }
                        }
                    ]
                },
                "explicitReply": true
            }
        },
        {
            "id": "flow:UnregisterService",
            "data": {
                "name": "UnregisterService",
                "description": "",
                "links": [
                    {
                        "id": 1,
                        "from": "LogUnregisterService",
                        "to": "TableMutate",
                        "type": "default"
                    },
                    {
                        "id": 2,
                        "from": "TableMutate",
                        "to": "Return",
                        "type": "expression",
                        "label": "TableMutatetoReturn",
                        "value": "$activity[TableMutate].Exists"
                    },
                    {
                        "id": 3,
                        "from": "TableMutate",
                        "to": "NotFound",
                        "type": "exprOtherwise",
                        "label": "TableMutatetoReturn1"
                    }
                ],
                "tasks": [
                    {
                        "id": "LogUnregisterService",
                        "name": "LogUnregisterService",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"^^^^^^ Unregister Service ^^^^^^ ID : \", $flow.ID, \", Type : \", $flow.Type, \", Location : \", $flow.Location)"
                            }
                        }
                    },
                    {
                        "id": "TableMutate",
                        "name": "TableMutate",
                        "description": "A simple activity for upserting/deleting data to/from table",
                        "activity": {
                            "ref": "#tablemutate",
                            "settings": {
                                "Table": {
                                    "id": "c6215040-4aff-11eb-9ffb-8db6499bd1d7",
                                    "type": "flogo:connector",
                                    "version": "1.0.0",
                                    "name": "tibco-simple-table",
                                    "hashTags": [],
                                    "inputMappings": {},
                                    "outputMappings": {},
                                    "iteratorMappings": {},
                                    "title": "Simple Table",
                                    "description": "This is URL file reader",
                                    "ref": "github.com/TIBCOSoftware/labs-lightcrane-contrib/connector/simpletable",
                                    "settings": [
                                        {
                                            "name": "name",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Name",
                                                "description": "Name of the table instance"
                                            },
                                            "value": "Services"
                                        },
                                        {
                                            "name": "description",
                                            "type": "string",
                                            "display": {
                                                "name": "Description",
                                                "description": "A simple table for storing tuple"
                                            },
                                            "value": ""
                                        },
										{
											"name": "properties",
											"type": "string",
											"required": true,
											"display": {
												"name": "Properties",
												"description": "Properties of the table"
											},
											"value": "=$property[\"System.Table.Properties\"]"
										},
                                        {
                                            "name": "schema",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Schema",
                                                "description": "Schema of the table"
                                            },
                                            "value": "[{\"Name\":\"ServiceID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"ServiceType\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"LocationID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"URL\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Properties\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Endpoint\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"}]"
                                        }
                                    ],
                                    "outputs": [],
                                    "inputs": [],
                                    "handler": {
                                        "settings": []
                                    },
                                    "reply": [],
                                    "s3Prefix": "flogo",
                                    "key": "flogo/GraphBuilder_Tools/connector/simpletable/connector.json",
                                    "display": {
                                        "description": "This is URL file reader",
                                        "category": "GraphBuilder_Tools",
                                        "visible": true,
                                        "smallIcon": "simpletable.png"
                                    },
                                    "actions": [
                                        {
                                            "name": "create",
                                            "display": {
                                                "name": "Create",
                                                "readonly": false,
                                                "valid": true,
                                                "visible": true
                                            }
                                        }
                                    ],
                                    "feature": {},
                                    "loopType": "none",
                                    "loopSettings": [],
                                    "retrySettings": [],
                                    "propertyMap": {},
                                    "keyfield": "name",
                                    "schemaMap": {},
                                    "iteratorAccumulate": false,
                                    "isValid": true,
                                    "lastUpdatedTime": 1637691762447,
                                    "user": "flogo",
                                    "connectorName": "Services",
                                    "connectorDescription": " "
                                },
                                "Method": "delete"
                            },
                            "input": {
                                "Mapping": {
                                    "mapping": {
                                        "ServiceID": "=$flow.ID",
                                        "ServiceType": "=$flow.Type",
                                        "LocationID": "=$flow.Location"
                                    }
                                }
                            },
                            "output": {
                                "Exists": false
                            }
                        }
                    },
                    {
                        "id": "Return",
                        "name": "Return",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Response": {
                                        "mapping": {
                                            "ID": "=$activity[TableMutate].Data.Old.ServiceID",
                                            "Type": "=$activity[TableMutate].Data.Old.ServiceType",
                                            "Location": "=$activity[TableMutate].Data.Old.LocationID"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "NotFound",
                        "name": "NotFound",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn"
                        }
                    }
                ],
                "metadata": {
                    "input": [
                        {
                            "name": "ID",
                            "type": "string"
                        },
                        {
                            "name": "Type",
                            "type": "string"
                        },
                        {
                            "name": "Location",
                            "type": "string"
                        }
                    ],
                    "output": [
                        {
                            "name": "Response",
                            "type": "object",
                            "schema": {
                                "type": "json",
                                "value": "{\"ID\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"},\"Location\":{\"type\":\"string\"}}"
                            }
                        }
                    ]
                },
                "explicitReply": true
            }
        },
        {
            "id": "flow:ListServices",
            "data": {
                "name": "ListServices",
                "description": "",
                "links": [
                    {
                        "id": 1,
                        "from": "LogListServices",
                        "to": "TableQuery",
                        "type": "default"
                    },
                    {
                        "id": 2,
                        "from": "TableQuery",
                        "to": "LogQueryResult",
                        "type": "default"
                    },
                    {
                        "id": 3,
                        "from": "LogQueryResult",
                        "to": "Mapping",
                        "type": "expression",
                        "label": "LogQueryResulttoMapping",
                        "value": "0!=array.count($activity[TableQuery].Data)"
                    },
                    {
                        "id": 4,
                        "from": "Mapping",
                        "to": "Return",
                        "type": "default"
                    },
                    {
                        "id": 5,
                        "from": "LogQueryResult",
                        "to": "Return_Nothing",
                        "type": "exprOtherwise",
                        "label": "LogQueryResult to Return_Nothing"
                    }
                ],
                "tasks": [
                    {
                        "id": "LogListServices",
                        "name": "LogListServices",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"^^^^^^ List Services ^^^^^^  Type : \", $flow.Type)"
                            }
                        }
                    },
                    {
                        "id": "TableQuery",
                        "name": "TableQuery",
                        "description": "A simple activity for quering data from table",
                        "activity": {
                            "ref": "#tablequery",
                            "settings": {
                                "Table": {
                                    "id": "c6215040-4aff-11eb-9ffb-8db6499bd1d7",
                                    "type": "flogo:connector",
                                    "version": "1.0.0",
                                    "name": "tibco-simple-table",
                                    "hashTags": [],
                                    "inputMappings": {},
                                    "outputMappings": {},
                                    "iteratorMappings": {},
                                    "title": "Simple Table",
                                    "description": "This is URL file reader",
                                    "ref": "github.com/TIBCOSoftware/labs-lightcrane-contrib/connector/simpletable",
                                    "settings": [
                                        {
                                            "name": "name",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Name",
                                                "description": "Name of the table instance"
                                            },
                                            "value": "Services"
                                        },
                                        {
                                            "name": "description",
                                            "type": "string",
                                            "display": {
                                                "name": "Description",
                                                "description": "A simple table for storing tuple"
                                            },
                                            "value": ""
                                        },
										{
											"name": "properties",
											"type": "string",
											"required": true,
											"display": {
												"name": "Properties",
												"description": "Properties of the table"
											},
											"value": "=$property[\"System.Table.Properties\"]"
										},
                                        {
                                            "name": "schema",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Schema",
                                                "description": "Schema of the table",
                                                "type": "table",
                                                "schema": "{\r\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\r\n    \"definitions\": {},\r\n    \"id\": \"http://example.com/example.json\",\r\n    \"items\": {\r\n        \"id\": \"/items\",\r\n        \"properties\": {\r\n            \"Name\": {\r\n                \"id\": \"/items/properties/Name\",\r\n                \"type\": \"string\"\r\n            },\r\n            \"Type\": {\r\n                \"id\": \"/items/properties/Type\",\r\n                \"type\": {\"enum\":[\"String\", \"Integer\", \"Long\", \"Double\", \"Boolean\", \"Date\", \"Object\"]}\r\n            },\r\n            \"IsKey\": {\r\n                \"id\": \"/items/properties/IsKey\",\r\n                \"type\": {\"enum\":[\"no\", \"yes\"]}\r\n            },\r\n            \"Indexed\": {\r\n                \"id\": \"/items/properties/Indexed\",\r\n                \"type\": {\"enum\":[\"no\", \"yes\"]}\r\n            }\r\n        },\r\n        \"type\": \"object\"\r\n    },\r\n    \"type\": \"array\"\r\n}"
                                            },
                                            "value": "[{\"Name\":\"ServiceID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"ServiceType\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"LocationID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"URL\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Properties\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Endpoint\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"}]"
                                        }
                                    ],
                                    "outputs": [],
                                    "inputs": [],
                                    "handler": {
                                        "settings": []
                                    },
                                    "reply": [],
                                    "s3Prefix": "flogo",
                                    "key": "flogo/GraphBuilder_Tools/connector/simpletable/connector.json",
                                    "display": {
                                        "description": "This is URL file reader",
                                        "category": "GraphBuilder_Tools",
                                        "visible": true,
                                        "smallIcon": "simpletable.png"
                                    },
                                    "actions": [
                                        {
                                            "name": "create",
                                            "display": {
                                                "name": "Create",
                                                "readonly": false,
                                                "valid": true,
                                                "visible": true
                                            }
                                        }
                                    ],
                                    "feature": {},
                                    "loopType": "none",
                                    "loopSettings": [],
                                    "retrySettings": [],
                                    "propertyMap": {},
                                    "keyfield": "name",
                                    "schemaMap": {},
                                    "iteratorAccumulate": false,
                                    "isValid": true,
                                    "lastUpdatedTime": 1637691762447,
                                    "user": "flogo",
                                    "connectorName": "Services",
                                    "connectorDescription": " "
                                },
                                "Indices": "ServiceType"
                            },
                            "input": {
                                "QueryKey": {
                                    "mapping": {
                                        "ServiceType": "=$flow.Type"
                                    }
                                }
                            },
                            "output": {
                                "Exists": false
                            }
                        }
                    },
                    {
                        "id": "LogQueryResult",
                        "name": "LogQueryResult",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"^^^^^^ Query Result ^^^^^^ TableQuery.Data : \", coerce.toString($activity[TableQuery].Data))"
                            }
                        }
                    },
                    {
                        "id": "Mapping",
                        "name": "Mapping",
                        "description": "Mapping field from input to output",
                        "type": "iterator",
                        "settings": {
                            "iterate": "=$activity[TableQuery].Data",
                            "accumulate": false
                        },
                        "activity": {
                            "ref": "#mapping",
                            "settings": {
                                "IsArray": true,
                                "MappingFields": "[{\"Name\":\"ID\",\"Type\":\"String\"},{\"Name\":\"Type\",\"Type\":\"String\"},{\"Name\":\"Location\",\"Type\":\"String\"}]"
                            },
                            "input": {
                                "Mapping": {
                                    "mapping": {
                                        "ArraySize": "=array.count($activity[TableQuery].Data)",
                                        "SkipCondition": false,
                                        "Type": "=$iteration[value].ServiceType",
                                        "ID": "=$iteration[value].ServiceID",
                                        "Location": "=$iteration[value].LocationID"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "Return",
                        "name": "Return",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Response": "=$activity[Mapping].Data"
                                }
                            }
                        }
                    },
                    {
                        "id": "Return_Nothing",
                        "name": "Return_Nothing",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Response": {
                                        "mapping": []
                                    }
                                }
                            }
                        }
                    }
                ],
                "metadata": {
                    "input": [
                        {
                            "name": "Type",
                            "type": "string"
                        }
                    ],
                    "output": [
                        {
                            "name": "Response",
                            "type": "array",
                            "schema": {
                                "type": "json",
                                "value": "{\"type\":\"object\",\"properties\":{\"ID\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}}}"
                            }
                        }
                    ]
                },
                "explicitReply": true
            }
        },
        {
            "id": "flow:ListServicesDetailsByLocation",
            "data": {
                "name": "ListServicesDetailsByLocation",
                "description": "",
                "links": [
                    {
                        "id": 1,
                        "from": "LogListServices",
                        "to": "TableQuery",
                        "type": "default"
                    },
                    {
                        "id": 2,
                        "from": "TableQuery",
                        "to": "LogQueryResult",
                        "type": "default"
                    },
                    {
                        "id": 3,
                        "from": "LogQueryResult",
                        "to": "Mapping",
                        "type": "expression",
                        "label": "LogQueryResulttoMapping",
                        "value": "0!=array.count($activity[TableQuery].Data)"
                    },
                    {
                        "id": 4,
                        "from": "Mapping",
                        "to": "Return",
                        "type": "default"
                    },
                    {
                        "id": 5,
                        "from": "LogQueryResult",
                        "to": "Return_Nothing",
                        "type": "exprOtherwise",
                        "label": "LogQueryResult to Return_Nothing"
                    }
                ],
                "tasks": [
                    {
                        "id": "LogListServices",
                        "name": "LogListServices",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"^^^^^^ List Services ^^^^^^  Location : \", $flow.Location, \", Type : \", $flow.Type)"
                            }
                        }
                    },
                    {
                        "id": "TableQuery",
                        "name": "TableQuery",
                        "description": "A simple activity for quering data from table",
                        "activity": {
                            "ref": "#tablequery",
                            "settings": {
                                "Table": {
                                    "id": "c6215040-4aff-11eb-9ffb-8db6499bd1d7",
                                    "type": "flogo:connector",
                                    "version": "1.0.0",
                                    "name": "tibco-simple-table",
                                    "hashTags": [],
                                    "inputMappings": {},
                                    "outputMappings": {},
                                    "iteratorMappings": {},
                                    "title": "Simple Table",
                                    "description": "This is URL file reader",
                                    "ref": "github.com/TIBCOSoftware/labs-lightcrane-contrib/connector/simpletable",
                                    "settings": [
                                        {
                                            "name": "name",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Name",
                                                "description": "Name of the table instance"
                                            },
                                            "value": "Services"
                                        },
                                        {
                                            "name": "description",
                                            "type": "string",
                                            "display": {
                                                "name": "Description",
                                                "description": "A simple table for storing tuple"
                                            },
                                            "value": ""
                                        },
										{
											"name": "properties",
											"type": "string",
											"required": true,
											"display": {
												"name": "Properties",
												"description": "Properties of the table"
											},
											"value": "=$property[\"System.Table.Properties\"]"
										},
                                        {
                                            "name": "schema",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Schema",
                                                "description": "Schema of the table"
                                            },
                                            "value": "[{\"Name\":\"ServiceID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"ServiceType\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"LocationID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"URL\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Properties\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"}]"
                                        }
                                    ],
                                    "outputs": [],
                                    "inputs": [],
                                    "handler": {
                                        "settings": []
                                    },
                                    "reply": [],
                                    "s3Prefix": "flogo",
                                    "key": "flogo/GraphBuilder_Tools/connector/simpletable/connector.json",
                                    "display": {
                                        "description": "This is URL file reader",
                                        "category": "GraphBuilder_Tools",
                                        "visible": true,
                                        "smallIcon": "simpletable.png"
                                    },
                                    "actions": [
                                        {
                                            "name": "create",
                                            "display": {
                                                "name": "Create",
                                                "readonly": false,
                                                "valid": true,
                                                "visible": true
                                            }
                                        }
                                    ],
                                    "feature": {},
                                    "loopType": "none",
                                    "loopSettings": [],
                                    "retrySettings": [],
                                    "propertyMap": {},
                                    "keyfield": "name",
                                    "schemaMap": {},
                                    "iteratorAccumulate": false,
                                    "isValid": true,
                                    "lastUpdatedTime": 1637691762447,
                                    "user": "flogo",
                                    "connectorName": "Services",
                                    "connectorDescription": " "
                                },
                                "Indices": "ServiceType LocationID"
                            },
                            "input": {
                                "QueryKey": {
                                    "mapping": {
                                        "ServiceType": "=$flow.Type",
                                        "LocationID": "=$flow.Location"
                                    }
                                }
                            },
                            "output": {
                                "Exists": false
                            }
                        }
                    },
                    {
                        "id": "LogQueryResult",
                        "name": "LogQueryResult",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"^^^^^^ Query Result ^^^^^^ TableQuery.Data : \", coerce.toString($activity[TableQuery].Data))"
                            }
                        }
                    },
                    {
                        "id": "Mapping",
                        "name": "Mapping",
                        "description": "Mapping field from input to output",
                        "type": "iterator",
                        "settings": {
                            "iterate": "=$activity[TableQuery].Data",
                            "accumulate": false
                        },
                        "activity": {
                            "ref": "#mapping",
                            "settings": {
                                "IsArray": true,
                                "MappingFields": "[{\"Name\":\"ID\",\"Type\":\"String\"},{\"Name\":\"Type\",\"Type\":\"String\"},{\"Name\":\"Location\",\"Type\":\"String\"},{\"Name\":\"URL\",\"Type\":\"String\"},{\"Name\":\"Properties\",\"Type\":\"Object\"}]"
                            },
                            "input": {
                                "Mapping": {
                                    "mapping": {
                                        "ArraySize": "=array.count($activity[TableQuery].Data)",
                                        "SkipCondition": false,
                                        "Type": "=$iteration[value].ServiceType",
                                        "ID": "=$iteration[value].ServiceID",
                                        "Location": "=$iteration[value].LocationID",
                                        "URL": "=$iteration[value].URL",
                                        "Properties": "=$iteration[value].Properties",
                                        "Endpoint": "=$iteration[value].Endpoint"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "Return",
                        "name": "Return",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Response": "=$activity[Mapping].Data"
                                }
                            }
                        }
                    },
                    {
                        "id": "Return_Nothing",
                        "name": "Return_Nothing",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Response": {
                                        "mapping": []
                                    }
                                }
                            }
                        }
                    }
                ],
                "metadata": {
                    "input": [
                        {
                            "name": "Type",
                            "type": "string"
                        },
                        {
                            "name": "Location",
                            "type": "string"
                        }
                    ],
                    "output": [
                        {
                            "name": "Response",
                            "type": "array",
                            "schema": {
                                "type": "json",
                                "value": "{\"type\":\"object\",\"properties\":{\"ID\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"},\"Location\":{\"type\":\"string\"},\"URL\":{\"type\":\"string\"},\"Properties\":{\"type\":\"object\",\"properties\":{}},\"Endpoint\":{\"type\":\"object\",\"properties\":{}}}}"
                            }
                        }
                    ]
                },
                "explicitReply": true
            }
        },
        {
            "id": "flow:LocateService",
            "data": {
                "name": "LocateService",
                "description": "",
                "links": [
                    {
                        "id": 1,
                        "from": "LogLocateService",
                        "to": "FindServiceInLocator",
                        "type": "default"
                    },
                    {
                        "id": 2,
                        "from": "FindServiceInLocator",
                        "to": "LogServiceFound",
                        "type": "expression",
                        "label": "TableQuerytoReturn",
                        "value": "$activity[FindServiceInLocator].Exists"
                    },
                    {
                        "id": 3,
                        "from": "LogServiceFound",
                        "to": "Return",
                        "type": "default"
                    },
                    {
                        "id": 4,
                        "from": "FindServiceInLocator",
                        "to": "LogServiceNotFound",
                        "type": "exprOtherwise",
                        "label": "TableQuerytoReturn1"
                    },
                    {
                        "id": 5,
                        "from": "LogServiceNotFound",
                        "to": "ReturnNothing",
                        "type": "default"
                    }
                ],
                "tasks": [
                    {
                        "id": "LogLocateService",
                        "name": "LogLocateService",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"^^^^^^ LocateService ^^^^^^ ServiceType : \", $flow.ServiceType, \", ServiceID : \", $flow.ServiceID)"
                            }
                        }
                    },
                    {
                        "id": "FindServiceInLocator",
                        "name": "FindServiceInLocator",
                        "description": "A simple activity for quering data from table",
                        "activity": {
                            "ref": "#tablequery",
                            "settings": {
                                "Table": {
                                    "id": "c6215040-4aff-11eb-9ffb-8db6499bd1d7",
                                    "type": "flogo:connector",
                                    "version": "1.0.0",
                                    "name": "tibco-simple-table",
                                    "hashTags": [],
                                    "inputMappings": {},
                                    "outputMappings": {},
                                    "iteratorMappings": {},
                                    "title": "Simple Table",
                                    "description": "This is URL file reader",
                                    "ref": "github.com/TIBCOSoftware/labs-lightcrane-contrib/connector/simpletable",
                                    "settings": [
                                        {
                                            "name": "name",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Name",
                                                "description": "Name of the table instance"
                                            },
                                            "value": "Services"
                                        },
                                        {
                                            "name": "description",
                                            "type": "string",
                                            "display": {
                                                "name": "Description",
                                                "description": "A simple table for storing tuple"
                                            },
                                            "value": ""
                                        },
										{
											"name": "properties",
											"type": "string",
											"required": true,
											"display": {
												"name": "Properties",
												"description": "Properties of the table"
											},
											"value": "=$property[\"System.Table.Properties\"]"
										},
                                        {
                                            "name": "schema",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Schema",
                                                "description": "Schema of the table"
                                            },
                                            "value": "[{\"Name\":\"ServiceID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"ServiceType\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"LocationID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"URL\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Properties\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Endpoint\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"}]"
                                        }
                                    ],
                                    "outputs": [],
                                    "inputs": [],
                                    "handler": {
                                        "settings": []
                                    },
                                    "reply": [],
                                    "s3Prefix": "flogo",
                                    "key": "flogo/GraphBuilder_Tools/connector/simpletable/connector.json",
                                    "display": {
                                        "description": "This is URL file reader",
                                        "category": "GraphBuilder_Tools",
                                        "visible": true,
                                        "smallIcon": "simpletable.png"
                                    },
                                    "actions": [
                                        {
                                            "name": "create",
                                            "display": {
                                                "name": "Create",
                                                "readonly": false,
                                                "valid": true,
                                                "visible": true
                                            }
                                        }
                                    ],
                                    "feature": {},
                                    "loopType": "none",
                                    "loopSettings": [],
                                    "retrySettings": [],
                                    "propertyMap": {},
                                    "keyfield": "name",
                                    "schemaMap": {},
                                    "iteratorAccumulate": false,
                                    "isValid": true,
                                    "lastUpdatedTime": 1641163953642,
                                    "user": "flogo",
                                    "connectorName": "Services",
                                    "connectorDescription": " "
                                },
                                "Indices": "ServiceID ServiceType"
                            },
                            "input": {
                                "QueryKey": {
                                    "mapping": {
                                        "ServiceID": "=$flow.ServiceID",
                                        "ServiceType": "=$flow.ServiceType"
                                    }
                                }
                            },
                            "output": {
                                "Exists": false
                            }
                        }
                    },
                    {
                        "id": "LogServiceFound",
                        "name": "LogServiceFound",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"^^^^^^ ServiceFound ^^^^^^ ServiceID : \", $flow.ServiceID)"
                            }
                        }
                    },
                    {
                        "id": "Return",
                        "name": "Return",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Code": "100",
                                    "Response": {
                                        "mapping": {
                                            "ID": "=$activity[FindServiceInLocator].Data[0].ServiceID",
                                            "Type": "=$activity[FindServiceInLocator].Data[0].ServiceType",
                                            "Location": "=$activity[FindServiceInLocator].Data[0].LocationID",
                                            "URL": "=$activity[FindServiceInLocator].Data[0].URL",
                                            "Properties": "=$activity[FindServiceInLocator].Data[0].Properties",
                                            "Endpoint": "=$activity[FindServiceInLocator].Data[0].Endpoint"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "LogServiceNotFound",
                        "name": "LogServiceNotFound",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"^^^^^^ Service Not Found ^^^^^^ ServiceID : \", $flow.ServiceID)"
                            }
                        }
                    },
                    {
                        "id": "ReturnNothing",
                        "name": "ReturnNothing",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Code": "101",
                                    "Response": {
                                        "mapping": {}
                                    }
                                }
                            }
                        }
                    }
                ],
                "metadata": {
                    "input": [
                        {
                            "name": "ServiceType",
                            "type": "string"
                        },
                        {
                            "name": "ServiceID",
                            "type": "string"
                        }
                    ],
                    "output": [
                        {
                            "name": "Code",
                            "type": "string"
                        },
                        {
                            "name": "Response",
                            "type": "object",
                            "schema": {
                                "type": "json",
                                "value": "{\"ID\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"},\"Location\":{\"type\":\"string\"},\"URL\":{\"type\":\"string\"},\"Properties\":{\"type\":\"object\",\"properties\":{}},\"Endpoint\":{\"type\":\"object\",\"properties\":{}}}"
                            }
                        }
                    ]
                },
                "explicitReply": true
            }
        },
        {
            "id": "flow:HTTPRedirect",
            "data": {
                "name": "HTTPRedirect",
                "description": "",
                "links": [
                    {
                        "id": 1,
                        "from": "GetServiceType",
                        "to": "Log",
                        "type": "default"
                    },
                    {
                        "id": 2,
                        "from": "Log",
                        "to": "TableQuery",
                        "type": "expression",
                        "label": "LogtoMapping",
                        "value": "\"ingerence\"!=$activity[GetServiceType].Data.ServiceType"
                    },
                    {
                        "id": 3,
                        "from": "TableQuery",
                        "to": "PrintURL01",
                        "type": "default"
                    },
                    {
                        "id": 4,
                        "from": "PrintURL01",
                        "to": "Return01",
                        "type": "default"
                    },
                    {
                        "id": 5,
                        "from": "Log",
                        "to": "AccessByID",
                        "type": "expression",
                        "label": "LogtoAccessByID",
                        "value": "\"ingerence\"!=$activity[GetServiceType].Data.ServiceType"
                    },
                    {
                        "id": 6,
                        "from": "AccessByID",
                        "to": "QueryByTypeNdID",
                        "type": "default"
                    },
                    {
                        "id": 7,
                        "from": "QueryByTypeNdID",
                        "to": "PrintURL02",
                        "type": "default"
                    },
                    {
                        "id": 8,
                        "from": "PrintURL02",
                        "to": "Return02",
                        "type": "default"
                    }
                ],
                "tasks": [
                    {
                        "id": "GetServiceType",
                        "name": "GetServiceType",
                        "description": "Mapping field from input to output",
                        "activity": {
                            "ref": "#mapping",
                            "settings": {
                                "IsArray": false,
                                "MappingFields": "[{\"Name\":\"ServiceType\",\"Type\":\"String\"}]"
                            },
                            "input": {
                                "Mapping": {
                                    "mapping": {
                                        "ServiceType": "=array.get(string.split($flow.RequestURL, \"/\"), 2)"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "Log",
                        "name": "Log",
                        "description": "Logs a message",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "message": "=$flow.RequestURL",
                                "addDetails": false
                            }
                        }
                    },
                    {
                        "id": "TableQuery",
                        "name": "TableQuery",
                        "description": "A simple activity for quering data from table",
                        "activity": {
                            "ref": "#tablequery",
                            "settings": {
                                "Table": {
                                    "id": "c6215040-4aff-11eb-9ffb-8db6499bd1d7",
                                    "type": "flogo:connector",
                                    "version": "1.0.0",
                                    "name": "tibco-simple-table",
                                    "hashTags": [],
                                    "inputMappings": {},
                                    "outputMappings": {},
                                    "iteratorMappings": {},
                                    "title": "Simple Table",
                                    "description": "This is URL file reader",
                                    "ref": "github.com/TIBCOSoftware/labs-lightcrane-contrib/connector/simpletable",
                                    "settings": [
                                        {
                                            "name": "name",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Name",
                                                "description": "Name of the table instance"
                                            },
                                            "value": "Services"
                                        },
                                        {
                                            "name": "description",
                                            "type": "string",
                                            "display": {
                                                "name": "Description",
                                                "description": "A simple table for storing tuple"
                                            },
                                            "value": ""
                                        },
										{
											"name": "properties",
											"type": "string",
											"required": true,
											"display": {
												"name": "Properties",
												"description": "Properties of the table"
											},
											"value": "=$property[\"System.Table.Properties\"]"
										},
                                        {
                                            "name": "schema",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Schema",
                                                "description": "Schema of the table"
                                            },
                                            "value": "[{\"Name\":\"ServiceID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"ServiceType\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"yes\"},{\"Name\":\"Plateform\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"URL\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Properties\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"}]"
                                        }
                                    ],
                                    "outputs": [],
                                    "inputs": [],
                                    "handler": {
                                        "settings": []
                                    },
                                    "reply": [],
                                    "s3Prefix": "flogo",
                                    "key": "flogo/GraphBuilder_Tools/connector/simpletable/connector.json",
                                    "display": {
                                        "description": "This is URL file reader",
                                        "category": "GraphBuilder_Tools",
                                        "visible": true,
                                        "smallIcon": "simpletable.png"
                                    },
                                    "actions": [
                                        {
                                            "name": "create",
                                            "display": {
                                                "name": "Create",
                                                "readonly": false,
                                                "valid": true,
                                                "visible": true
                                            }
                                        }
                                    ],
                                    "feature": {},
                                    "loopType": "none",
                                    "loopSettings": [],
                                    "retrySettings": [],
                                    "propertyMap": {},
                                    "keyfield": "name",
                                    "schemaMap": {},
                                    "iteratorAccumulate": false,
                                    "isValid": true,
                                    "lastUpdatedTime": 1609374841324,
                                    "user": "flogo",
                                    "connectorName": "Services",
                                    "connectorDescription": " "
                                },
                                "Indices": "ServiceType"
                            },
                            "input": {
                                "QueryKey": {
                                    "mapping": {
                                        "ServiceType": "=$activity[GetServiceType].Data.ServiceType"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "PrintURL01",
                        "name": "PrintURL01",
                        "description": "Logs a message",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "message": "=$activity[TableQuery].Data[0].URL",
                                "addDetails": false
                            }
                        }
                    },
                    {
                        "id": "Return01",
                        "name": "Return01",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "RedirectURL": "=$activity[TableQuery].Data[0].URL+string.substringAfter($flow.RequestURL, $activity[GetServiceType].Data.ServiceType)"
                                }
                            }
                        }
                    },
                    {
                        "id": "AccessByID",
                        "name": "AccessByID",
                        "description": "Mapping field from input to output",
                        "activity": {
                            "ref": "#mapping",
                            "settings": {
                                "IsArray": false,
                                "MappingFields": "[{\"Name\":\"ServiceType\",\"Type\":\"String\"},{\"Name\":\"ServiceID\",\"Type\":\"String\"}]"
                            },
                            "input": {
                                "Mapping": {
                                    "mapping": {
                                        "ServiceType": "=array.get(string.split($flow.RequestURL, \"/\"), 2)",
                                        "ServiceID": "=array.get(string.split($flow.RequestURL, \"/\"), 3)"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "QueryByTypeNdID",
                        "name": "QueryByTypeNdID",
                        "description": "A simple activity for quering data from table",
                        "activity": {
                            "ref": "#tablequery",
                            "settings": {
                                "Table": {
                                    "id": "c6215040-4aff-11eb-9ffb-8db6499bd1d7",
                                    "type": "flogo:connector",
                                    "version": "1.0.0",
                                    "name": "tibco-simple-table",
                                    "hashTags": [],
                                    "inputMappings": {},
                                    "outputMappings": {},
                                    "iteratorMappings": {},
                                    "title": "Simple Table",
                                    "description": "This is URL file reader",
                                    "ref": "github.com/TIBCOSoftware/labs-lightcrane-contrib/connector/simpletable",
                                    "settings": [
                                        {
                                            "name": "name",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Name",
                                                "description": "Name of the table instance"
                                            },
                                            "value": "Services"
                                        },
                                        {
                                            "name": "description",
                                            "type": "string",
                                            "display": {
                                                "name": "Description",
                                                "description": "A simple table for storing tuple"
                                            },
                                            "value": ""
                                        },
										{
											"name": "properties",
											"type": "string",
											"required": true,
											"display": {
												"name": "Properties",
												"description": "Properties of the table"
											},
											"value": "=$property[\"System.Table.Properties\"]"
										},
                                        {
                                            "name": "schema",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Schema",
                                                "description": "Schema of the table"
                                            },
                                            "value": "[{\"Name\":\"ServiceID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"ServiceType\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"yes\"},{\"Name\":\"Plateform\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"URL\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Properties\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"}]"
                                        }
                                    ],
                                    "outputs": [],
                                    "inputs": [],
                                    "handler": {
                                        "settings": []
                                    },
                                    "reply": [],
                                    "s3Prefix": "flogo",
                                    "key": "flogo/GraphBuilder_Tools/connector/simpletable/connector.json",
                                    "display": {
                                        "description": "This is URL file reader",
                                        "category": "GraphBuilder_Tools",
                                        "visible": true,
                                        "smallIcon": "simpletable.png"
                                    },
                                    "actions": [
                                        {
                                            "name": "create",
                                            "display": {
                                                "name": "Create",
                                                "readonly": false,
                                                "valid": true,
                                                "visible": true
                                            }
                                        }
                                    ],
                                    "feature": {},
                                    "loopType": "none",
                                    "loopSettings": [],
                                    "retrySettings": [],
                                    "propertyMap": {},
                                    "keyfield": "name",
                                    "schemaMap": {},
                                    "iteratorAccumulate": false,
                                    "isValid": true,
                                    "lastUpdatedTime": 1609374841324,
                                    "user": "flogo",
                                    "connectorName": "Services",
                                    "connectorDescription": " "
                                },
                                "Indices": "ServiceID ServiceType"
                            },
                            "input": {
                                "QueryKey": {
                                    "mapping": {
                                        "ServiceType": "=$activity[AccessByID].Data.ServiceType",
                                        "ServiceID": "=$activity[AccessByID].Data.ServiceID"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "PrintURL02",
                        "name": "PrintURL02",
                        "description": "Logs a message",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "message": "=$activity[QueryByTypeNdID].Data[0].URL",
                                "addDetails": false
                            }
                        }
                    },
                    {
                        "id": "Return02",
                        "name": "Return02",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "RedirectURL": "=$activity[QueryByTypeNdID].Data[0].URL"
                                }
                            }
                        }
                    }
                ],
                "metadata": {
                    "input": [
                        {
                            "name": "RequestURL",
                            "type": "string"
                        }
                    ],
                    "output": [
                        {
                            "name": "RedirectURL",
                            "type": "string"
                        }
                    ]
                }
            }
        },
        {
            "id": "flow:GetMetadata",
            "data": {
                "name": "GetMetadata",
                "description": "",
                "links": [
                    {
                        "id": 1,
                        "from": "LogGetMetadata",
                        "to": "TableQuery",
                        "type": "default"
                    },
                    {
                        "id": 2,
                        "from": "TableQuery",
                        "to": "Return",
                        "type": "default"
                    }
                ],
                "tasks": [
                    {
                        "id": "LogGetMetadata",
                        "name": "LogGetMetadata",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"^^^^^^ Get Metadata ^^^^^^ Name : \", $flow.Name)"
                            }
                        }
                    },
                    {
                        "id": "TableQuery",
                        "name": "TableQuery",
                        "description": "A simple activity for quering data from table",
                        "activity": {
                            "ref": "#tablequery",
                            "settings": {
                                "Table": {
                                    "id": "c62065e0-4aff-11eb-9ffb-8db6499bd1d7",
                                    "type": "flogo:connector",
                                    "version": "1.0.0",
                                    "name": "tibco-simple-table",
                                    "hashTags": [],
                                    "inputMappings": {},
                                    "outputMappings": {},
                                    "iteratorMappings": {},
                                    "title": "Simple Table",
                                    "description": "This is URL file reader",
                                    "ref": "github.com/TIBCOSoftware/labs-lightcrane-contrib/connector/simpletable",
                                    "settings": [
                                        {
                                            "name": "name",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Name",
                                                "description": "Name of the table instance"
                                            },
                                            "value": "Metadata"
                                        },
                                        {
                                            "name": "description",
                                            "type": "string",
                                            "display": {
                                                "name": "Description",
                                                "description": "A simple table for storing tuple"
                                            },
                                            "value": ""
                                        },
										{
											"name": "properties",
											"type": "string",
											"required": true,
											"display": {
												"name": "Properties",
												"description": "Properties of the table"
											},
											"value": "=$property[\"System.Table.Properties\"]"
										},
                                        {
                                            "name": "schema",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Schema",
                                                "description": "Schema of the table"
                                            },
                                            "value": "[{\"Name\":\"ServiceID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"ServiceType\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"LocationID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"URL\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Properties\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Endpoint\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"}]"
                                        }
                                    ],
                                    "outputs": [],
                                    "inputs": [],
                                    "handler": {
                                        "settings": []
                                    },
                                    "reply": [],
                                    "s3Prefix": "flogo",
                                    "key": "flogo/GraphBuilder_Tools/connector/simpletable/connector.json",
                                    "display": {
                                        "description": "This is URL file reader",
                                        "category": "GraphBuilder_Tools",
                                        "visible": true,
                                        "smallIcon": "simpletable.png"
                                    },
                                    "actions": [
                                        {
                                            "name": "create",
                                            "display": {
                                                "name": "Create",
                                                "readonly": false,
                                                "valid": true,
                                                "visible": true
                                            }
                                        }
                                    ],
                                    "feature": {},
                                    "loopType": "none",
                                    "loopSettings": [],
                                    "retrySettings": [],
                                    "propertyMap": {},
                                    "keyfield": "name",
                                    "schemaMap": {},
                                    "iteratorAccumulate": false,
                                    "isValid": true,
                                    "lastUpdatedTime": 1609374835534,
                                    "user": "flogo",
                                    "connectorName": "Metadata",
                                    "connectorDescription": " "
                                },
                                "Indices": "Name"
                            }
                        }
                    },
                    {
                        "id": "Return",
                        "name": "Return",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn"
                        }
                    }
                ],
                "metadata": {
                    "input": [
                        {
                            "name": "Name",
                            "type": "string"
                        }
                    ],
                    "output": [
                        {
                            "name": "Name",
                            "type": "string"
                        },
                        {
                            "name": "Value",
                            "type": "object"
                        }
                    ]
                },
                "explicitReply": true
            }
        }
    ],
    "properties": [
        {
            "name": "System.Table.Properties",
            "type": "string",
            "value": "{\"tableType\":\"InMemory\"}"
        }
    ],
    "connections": {}
}