{
    "imports": [        
        "github.com/project-flogo/flow", 
        "github.com/project-flogo/contrib/activity/actreturn",
        "github.com/project-flogo/flow/activity/subflow",
        "github.com/project-flogo/contrib/trigger/rest",
        "github.com/project-flogo/contrib/trigger/timer",
        "github.com/project-flogo/contrib/function/array",
        "github.com/project-flogo/contrib/function/string", 
        "github.com/project-flogo/contrib/function/coerce", 
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/function/f1",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/log",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/modelparameterbuilder",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/mapping",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/exec",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/objectmaker",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/objectserializer",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/filewriter",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/jsonserializer",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/httpclient",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/airpipelinebuilder",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/tableupsert",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/tablemutate",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/filereader", 
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/textreplacer",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/jsondeserializer",
        "github.com/TIBCOSoftware/labs-lightcrane-contrib/activity/aircomponentquerier"  
    ],
    "name": "ModelService",
    "description": "",
    "version": "1.0.0",
    "type": "flogo:app",
    "appModel": "1.1.1",
    "triggers": [
        {
            "ref": "#rest",
            "name": "tibco-wi-rest",
            "description": "Simple REST Trigger",
            "settings": {
                "port": 10097,
                "enableTLS": false,
                "certFile": "",
                "keyFile": ""
            },
            "id": "ReceiveHTTPMessage",
            "handlers": [
                {
                    "description": "**** Build ML model service ****",
                    "settings": {
                        "method": "POST",
                        "path": "/f1/modelservice/build/:id/:name"
                    },
                    "action": {
                        "ref": "github.com/project-flogo/flow",
                        "settings": {
                            "flowURI": "res://flow:Build_Model_Service"
                        },
                        "input": {
                            "ProjectID": "=$.pathParams.id",
                            "SyncBuild": "=$.content.SyncBuild",
                            "ComponentType": "=$.content.ComponentType",
                            "ServiceType": "=$.content.ServiceType",
                            "Image": "=$.content.Image",
                            "ScriptSystemEnv": "=$.content.ScriptSystemEnv",
                            "Name": "=$.pathParams.name",
                            "ModelDescriptor": "=$.content.ModelDescriptor"
                        },
                        "output": {
                            "code": 200,
                            "data": {
                                "mapping": {
                                    "Success": "=$.Success",
                                    "Message": "=$.Message",
                                    "ErrorCode": "=$.ErrorCode"
                                }
                            }
                        }
                    },
                    "reply": {
                        "code": 200,
                        "message": {}
                    },
                    "name": "Build_Model_Service"
                },
                {
                    "description": "**** Only for flogo pipeline ****",
                    "settings": {
                        "method": "POST",
                        "path": "/f1/modelservice/validate/:id/:name"
                    },
                    "action": {
                        "ref": "github.com/project-flogo/flow",
                        "settings": {
                            "flowURI": "res://flow:Validate_a_model_descriptor_then_convert_to_Flogo_descriptor"
                        },
                        "input": {
                            "ProjectID": "=$.pathParams.id",
                            "Name": "=$.pathParams.name",
                            "SyncBuild": "=$.content.SyncBuild",
                            "ComponentType": "=$.content.ComponentType",
                            "ServiceType": "=$.content.ServiceType",
                            "Image": "=$.content.Image",
                            "ModelDescriptor": "=$.content.ModelDescriptor",
                            "ScriptSystemEnv": "=$.content.ScriptSystemEnv"
                        },
                        "output": {
                            "code": 200,
                            "data": {
                                "mapping": {
                                    "Success": "=$.Success",
                                    "Message": "=$.Message",
                                    "ErrorCode": "=$.ErrorCode"
                                }
                            }
                        }
                    },
                    "reply": {
                        "code": 200,
                        "message": {}
                    },
                    "name": "Validate_a_model_descriptor_then_convert_to_Flogo_descriptor"
                },
                {
                    "description": "**** The entry point for project air UI ****",
                    "settings": {
                        "method": "POST",
                        "path": "/f1/modelservice/buildAndDeploy/:id/:name"
                    },
                    "action": {
                        "ref": "github.com/project-flogo/flow",
                        "settings": {
                            "flowURI": "res://flow:Build_and_Deploy_ML_Model_Service"
                        },
                        "input": {
                            "ComponentType": "=$.content.ComponentType",
                            "ServiceType": "=$.content.ServiceType",
                            "Image": "=$.content.Image",
                            "ScriptSystemEnv": "=$.content.ScriptSystemEnv",
                            "ModelDescriptor": "=$.content.ModelDescriptor",
                            "ProjectID": "=$.pathParams.id",
                            "Name": "=$.pathParams.name",
                            "SyncBuild": false,
                            "artifacts": "=$.content.artifacts"
                        },
                        "output": {
                            "code": 200,
                            "data": {
                                "mapping": {
                                    "Success": "=$.Success",
                                    "Message": "=$.Message",
                                    "ErrorCode": "=$.ErrorCode"
                                }
                            }
                        }
                    },
                    "reply": {
                        "code": 200,
                        "message": {}
                    },
                    "name": "Build_and_Deploy_ML_Model_Service"
                },
                {
                    "description": "",
                    "settings": {
                        "method": "POST",
                        "path": "/f1/modelservice/undeploy/:id/:name/:instance"
                    },
                    "action": {
                        "ref": "github.com/project-flogo/flow",
                        "settings": {
                            "flowURI": "res://flow:Undeploy_Model_Service"
                        },
                        "input": {
                            "ProjectID": "=$.pathParams.id",
                            "Method": "=$.content.Method",
                            "SyncDeploy": "=$.content.SyncDeploy",
                            "ScriptSystemEnv": "=$.content.ScriptSystemEnv",
                            "Name": "=$.pathParams.name",
                            "Instance": "=$.pathParams.instance"
                        },
                        "output": {
                            "code": 200,
                            "data": {
                                "mapping": {
                                    "Success": "=$.Success",
                                    "Message": "=$.Message",
                                    "ErrorCode": "=$.ErrorCode"
                                }
                            }
                        }
                    },
                    "reply": {
                        "code": 200,
                        "message": {}
                    },
                    "name": "Undeploy_Model_Service"
                },
                {
                    "description": "",
                    "settings": {
                        "method": "POST",
                        "path": "/f1/modelservice/deploy/:id/:name/:instance"
                    },
                    "action": {
                        "ref": "github.com/project-flogo/flow",
                        "settings": {
                            "flowURI": "res://flow:Deploy_Model_Service"
                        },
                        "input": {
                            "ProjectID": "=$.pathParams.id",
                            "Method": "=$.content.Method",
                            "ScriptSystemEnv": "=$.content.ScriptSystemEnv",
                            "ModelDescriptor": "=$.content.ModelDescriptor",
                            "SyncDeploy": "=$.content.SyncDeploy",
                            "Name": "=$.pathParams.name",
                            "Instance": "=$.pathParams.instance"
                        },
                        "output": {
                            "code": 200,
                            "data": {
                                "mapping": {
                                    "Success": "=$.Success",
                                    "Message": "=$.Message",
                                    "ErrorCode": "=$.ErrorCode"
                                }
                            }
                        }
                    },
                    "reply": {
                        "code": 200,
                        "message": {}
                    },
                    "name": "Deploy_Model_Service"
                },
                {
                    "description": "**** Builder callback to report build result ****",
                    "settings": {
                        "method": "POST",
                        "path": "/f1/modelservice/rsvp/:id/:name",
                        "OutputValidation": false
                    },
                    "action": {
                        "ref": "github.com/project-flogo/flow",
                        "settings": {
                            "flowURI": "res://flow:RSVP_from_builder"
                        },
                        "input": {
                            "ProjectID": "=$.pathParams.id",
                            "Name": "=$.pathParams.name",
                            "Successful": "=$.content.Successful",
                            "ErrorMsg": "=$.content.ErrorMsg"
                        },
                        "output": {
                            "code": 200,
                            "data": {
                                "mapping": {
                                    "Success": "=$.Success",
                                    "Message": "=$.Message",
                                    "ErrorCode": "=$.ErrorCode"
                                }
                            }
                        }
                    },
                    "reply": {
                        "code": 200,
                        "message": {}
                    },
                    "name": "RSVP_from_builder"
                }
            ]
        },
        {
            "ref": "#timer",
            "name": "flogo-timer",
            "description": "Simple Timer trigger",
            "settings": {},
            "id": "Timer",
            "handlers": [
                {
                    "description": "",
                    "settings": {
                        "startDelay": "",
                        "repeatInterval": "60s"
                    },
                    "action": {
                        "ref": "github.com/project-flogo/flow",
                        "settings": {
                            "flowURI": "res://flow:Ping"
                        },
                        "input": {
                            "Now": ""
                        }
                    },
                    "name": "Ping"
                }
            ]
        }
    ],
    "resources": [
        {
            "id": "flow:Build_Deploy_Desc",
            "data": {
                "name": "Build Deploy Desc",
                "description": "",
                "links": [
                    {
                        "id": 1,
                        "from": "LogMessage",
                        "to": "AirK8sParameterBuilder",
                        "type": "expression",
                        "label": "LogMessage to AirK8sParameterBuilder",
                        "value": "\"k8s\" == $flow.ServiceType"
                    },
                    {
                        "id": 2,
                        "from": "AirK8sParameterBuilder",
                        "to": "Return01",
                        "type": "default"
                    },
                    {
                        "id": 3,
                        "from": "LogMessage",
                        "to": "AirDockerComposeParameterBuilder",
                        "type": "exprOtherwise",
                        "label": "LogMessage to AirDockerComposeParameterBuilder"
                    },
                    {
                        "id": 4,
                        "from": "AirDockerComposeParameterBuilder",
                        "to": "Return02",
                        "type": "default"
                    }
                ],
                "tasks": [
                    {
                        "id": "LogMessage",
                        "name": "LogMessage",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:BuildDeployDesc %%%%% ProjectID : \", $flow.ProjectID, \", Name : \", $flow.Name, \", ServiceType : \", $flow.ServiceType, \", Image : \", $flow.Image, \", ModelDescriptor : \", coerce.toString($flow.ModelDescriptor), \", ScriptSystemEnv : \", coerce.toString($flow.ScriptSystemEnv))"
                            }
                        }
                    },
                    {
                        "id": "AirK8sParameterBuilder",
                        "name": "AirK8sParameterBuilder",
                        "description": "This activity build application pipeline",
                        "activity": {
                            "ref": "#modelparameterbuilder",
                            "settings": {
                                "TemplateFolder": "/home/airpipeline",
                                "leftToken": "$",
                                "rightToken": "$",
                                "variablesDef": "[{\"Name\":\"Name\",\"Type\":\"String\"},{\"Name\":\"ImageName\",\"Type\":\"String\"}]",
                                "Properties": "[{\"Name\":\"main_apiVersion\",\"Value\":\"apps/v1\"},{\"Name\":\"main_kind\",\"Value\":\"Deployment\"},{\"Name\":\"main_metadata.name\",\"Value\":\"$Name$\"},{\"Name\":\"main_spec.template.spec.containers[0].image\",\"Value\":\"$ImageName$\"},{\"Name\":\"main_spec.template.spec.containers[0].name\",\"Value\":\"$Name$\"},{\"Name\":\"main_spec.selector.matchLabels.component\",\"Value\":\"$Name$\"},{\"Name\":\"main_spec.template.metadata.labels.component\",\"Value\":\"$Name$\"},{\"Name\":\"ip-service_apiVersion\",\"Value\":\"v1\"},{\"Name\":\"ip-service_kind\",\"Value\":\"Service\"},{\"Name\":\"ip-service_metadata.name\",\"Value\":\"$Name$-ip-service\"},{\"Name\":\"ip-service_spec.selector.component\",\"Value\":\"$Name$\"},{\"Name\":\"ip-service_spec.type\",\"Value\":\"LoadBalancer\"}]"
                            },
                            "input": {
                                "ServiceType": "=$flow.ServiceType",
                                "PropertyPrefix": "spec.template.spec.containers[0]",
                                "FlogoAppDescriptor": "=$flow.ModelDescriptor",
                                "Variables": {
                                    "mapping": {
                                        "Name": "=$flow.Name",
                                        "ImageName": "=$flow.Image"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "Return01",
                        "name": "Return01",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Success": true,
                                    "Message": "AirService::Validate Pipeline - done",
                                    "ErrorCode": 100,
                                    "Descriptor": {
                                        "mapping": {
                                            "DeployDescriptor": "=$property[\"Descriptor.k8s\"]",
                                            "properties": "=$activity[AirK8sParameterBuilder].F1Properties"
                                        }
                                    },
                                    "PropertyNameDef": "=$activity[AirK8sParameterBuilder].PropertyNameDef"
                                }
                            }
                        }
                    },
                    {
                        "id": "AirDockerComposeParameterBuilder",
                        "name": "AirDockerComposeParameterBuilder",
                        "description": "This activity build application pipeline",
                        "activity": {
                            "ref": "#modelparameterbuilder",
                            "settings": {
                                "TemplateFolder": "/home/airpipeline",
                                "leftToken": "$",
                                "rightToken": "$",
                                "variablesDef": "[{\"Name\":\"Name\",\"Type\":\"String\"},{\"Name\":\"ImageName\",\"Type\":\"String\"},{\"Name\":\"ContainerName\",\"Type\":\"String\"},{\"Name\":\"BuildName\",\"Type\":\"String\"}]",
                                "Properties": "[{\"Name\":\"version\",\"Value\":\"3.6\"},{\"Name\":\"services.$Name$.container_name\",\"Value\":\"$ContainerName$\"},{\"Name\":\"services.$Name$.image\",\"Value\":\"$ImageName$\"},{\"Name\":\"services.$Name$.build\",\"Value\":\"$BuildName$\"}]"
                            },
                            "input": {
                                "ServiceType": "=$flow.ServiceType",
                                "PropertyPrefix": "services.$Name$",
                                "FlogoAppDescriptor": "=$flow.ModelDescriptor",
                                "Variables": {
                                    "mapping": {
                                        "Name": "=$flow.Name",
                                        "ImageName": "=$flow.Image",
                                        "ContainerName": "=$flow.ProjectID+\"_\"+$flow.Name",
                                        "BuildName": "=f1.ternary(null==$flow.Image||\"\"==$flow.Image, \"001\", \"\")"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "Return02",
                        "name": "Return02",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Success": true,
                                    "Message": "AirService::Validate Pipeline - done",
                                    "ErrorCode": 100,
                                    "Descriptor": {
                                        "mapping": {
                                            "DeployDescriptor": "=$property[\"Descriptor.docker\"]",
                                            "properties": "=$activity[AirDockerComposeParameterBuilder].F1Properties"
                                        }
                                    },
                                    "PropertyNameDef": "=$activity[AirDockerComposeParameterBuilder].PropertyNameDef"
                                }
                            }
                        }
                    }
                ],
                "errorHandler": {
                    "tasks": [
                        {
                            "id": "Return03",
                            "name": "Return03",
                            "description": "Simple Return Activity",
                            "activity": {
                                "ref": "#actreturn",
                                "settings": {
                                    "mappings": {
                                        "Success": false,
                                        "ErrorCode": 400,
                                        "Message": "=string.concat(\"AirService::Validate Pipeline - \", $error.message)"
                                    }
                                }
                            }
                        }
                    ],
                    "links": []
                },
                "metadata": {
                    "input": [
                        {
                            "name": "ProjectID",
                            "type": "string"
                        },
                        {
                            "name": "Name",
                            "type": "string"
                        },
                        {
                            "name": "ServiceType",
                            "type": "string"
                        },
                        {
                            "name": "Image",
                            "type": "string"
                        },
                        {
                            "name": "ModelDescriptor",
                            "type": "object",
                            "schema": {
                                "type": "json",
                                "value": "{\"Runner\":{\"type\":\"string\"},\"properties\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"}}}},\"ports\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"extra\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"}}}}}"
                            }
                        },
                        {
                            "name": "ScriptSystemEnv",
                            "type": "object",
                            "schema": {
                                "type": "json",
                                "value": "{\"TargetServer\":{\"type\":\"string\"},\"Username\":{\"type\":\"string\"}}"
                            }
                        }
                    ],
                    "output": [
                        {
                            "name": "Success",
                            "type": "boolean"
                        },
                        {
                            "name": "Message",
                            "type": "string"
                        },
                        {
                            "name": "ErrorCode",
                            "type": "float64"
                        },
                        {
                            "name": "Descriptor",
                            "type": "object",
                            "schema": {
                                "type": "json",
                                "value": "{\"properties\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{}}},\"DeployDescriptor\":{\"type\":\"string\"}}"
                            }
                        },
                        {
                            "name": "PropertyNameDef",
                            "type": "object"
                        }
                    ]
                }
            }
        },
        {
            "id": "flow:Call_Lightcrane_Service",
            "data": {
                "name": "Call Lightcrane Service",
                "description": "",
                "links": [
                    {
                        "id": 1,
                        "from": "LogRequestToLC",
                        "to": "ToLightcrane",
                        "type": "default"
                    },
                    {
                        "id": 2,
                        "from": "ToLightcrane",
                        "to": "LogResponseFromLC",
                        "type": "default"
                    },
                    {
                        "id": 3,
                        "from": "ToLightcrane",
                        "to": "ReportStatus",
                        "type": "expression",
                        "label": "ToDeployF1DescriptortoReturn",
                        "value": "true==$activity[ToLightcrane].Success"
                    },
                    {
                        "id": 4,
                        "from": "ReportStatus",
                        "to": "BuildResponse",
                        "type": "default"
                    },
                    {
                        "id": 5,
                        "from": "BuildResponse",
                        "to": "Return",
                        "type": "default"
                    },
                    {
                        "id": 6,
                        "from": "ToLightcrane",
                        "to": "FailReturn",
                        "type": "exprOtherwise",
                        "label": "ToDeployF1Descriptor to FailReturn"
                    }
                ],
                "tasks": [
                    {
                        "id": "LogRequestToLC",
                        "name": "LogRequestToLC",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:LogCallLightcraneService %%%%% Request To LightcraneService : RequestBody : \", $flow.RequestBody, \", Properties : \", coerce.toString($flow.Properties))"
                            }
                        }
                    },
                    {
                        "id": "ToLightcrane",
                        "name": "ToLightcrane",
                        "description": "This activity build docker image from Dockerfile",
                        "activity": {
                            "ref": "#httpclient",
                            "settings": {
                                "method": "POST",
                                "timeout": "10000",
                                "urlMappingString": "",
                                "leftToken": "$",
                                "rightToken": "$"
                            },
                            "input": {
                                "URL": "=$flow.ServiceURL",
                                "Body": "=$flow.RequestBody",
                                "SkipCondition": false
                            }
                        }
                    },
                    {
                        "id": "LogResponseFromLC",
                        "name": "LogResponseFromLC",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:LogResponseFromLC %%%%% Success : \", coerce.toString($activity[ToLightcrane].Success), \", Data : \", $activity[ToLightcrane].Data, \", ErrorCode : \", coerce.toString($activity[ToLightcrane].ErrorCode))"
                            }
                        }
                    },
                    {
                        "id": "ReportStatus",
                        "name": "ReportStatus",
                        "description": "Simple SubFlow Activity",
                        "activity": {
                            "ref": "#subflow",
                            "settings": {
                                "flowURI": "res://flow:Update_Deployment"
                            },
                            "input": {
                                "ID": "=string.concat($flow.ProjectID, \"_\", $flow.Name)",
                                "Type": "deployment",
                                "URL": "na",
                                "Properties": "=f1.modifyobject($flow.Properties, \"Status\", f1.getsubobject(f1.json2object($activity[ToLightcrane].Data), \"Message\"))",
                                "Delete": false,
                                "Location": "=$flow.Location"
                            }
                        }
                    },
                    {
                        "id": "BuildResponse",
                        "name": "BuildResponse",
                        "description": "JSON Deserializer Activity",
                        "activity": {
                            "ref": "#jsondeserializer",
                            "settings": {
                                "schemaFromfile": false,
                                "sample": "",
                                "dataSample": {
                                    "metadata": "{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"Success\":{\"type\":\"boolean\"},\"Message\":{\"type\":\"string\"},\"ErrorCode\":{\"type\":\"number\"}}}",
                                    "value": "",
                                    "fe_metadata": "{\n        \"Success\": true,\n        \"Message\": \"\",\n        \"ErrorCode\": 100\n}"
                                }
                            },
                            "input": {
                                "JSONString": "=$activity[ToLightcrane].Data"
                            }
                        }
                    },
                    {
                        "id": "Return",
                        "name": "Return",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Message": "=$activity[BuildResponse].Data.Message",
                                    "ErrorCode": "=$activity[BuildResponse].Data.ErrorCode",
                                    "Success": "=$activity[BuildResponse].Data.Success"
                                }
                            }
                        }
                    },
                    {
                        "id": "FailReturn",
                        "name": "FailReturn",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Message": "=$activity[ToLightcrane].Data",
                                    "ErrorCode": "=$activity[ToLightcrane].ErrorCode",
                                    "Success": "=$activity[ToLightcrane].Success"
                                }
                            }
                        }
                    }
                ],
                "metadata": {
                    "input": [
                        {
                            "name": "ServiceURL",
                            "type": "string"
                        },
                        {
                            "name": "RequestBody",
                            "type": "string"
                        },
                        {
                            "name": "ProjectID",
                            "type": "string"
                        },
                        {
                            "name": "Name",
                            "type": "string"
                        },
                        {
                            "name": "Location",
                            "type": "string"
                        },
                        {
                            "name": "Properties",
                            "type": "object"
                        }
                    ],
                    "output": [
                        {
                            "name": "Success",
                            "type": "boolean"
                        },
                        {
                            "name": "Message",
                            "type": "string"
                        },
                        {
                            "name": "ErrorCode",
                            "type": "float64"
                        }
                    ],
                    "fe_metadata": {
                        "input": "{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"ServiceURL\":{\"type\":\"string\"},\"RequestBody\":{\"type\":\"string\"},\"ProjectID\":{\"type\":\"string\"},\"Name\":{\"type\":\"string\"},\"Location\":{\"type\":\"string\"},\"Properties\":{\"type\":\"object\",\"properties\":{}}}}",
                        "output": "{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"Success\":{\"type\":\"boolean\"},\"Message\":{\"type\":\"string\"},\"ErrorCode\":{\"type\":\"number\"}}}"
                    }
                }
            }
        },
        {
            "id": "flow:Update_Deployment",
            "data": {
                "name": "Update Deployment",
                "description": "",
                "links": [
                    {
                        "id": 1,
                        "from": "LogDeployment",
                        "to": "BuildDeploymentInfo",
                        "type": "default"
                    },
                    {
                        "id": 2,
                        "from": "BuildDeploymentInfo",
                        "to": "LogUpdateDeployment",
                        "type": "expression",
                        "label": "BuildDeploymentInfotoPublishDeploymentStatus",
                        "value": "false==$flow.Delete"
                    },
                    {
                        "id": 3,
                        "from": "LogUpdateDeployment",
                        "to": "PublishDeploymentStatus",
                        "type": "default"
                    },
                    {
                        "id": 4,
                        "from": "BuildDeploymentInfo",
                        "to": "UnregisterDeployment",
                        "type": "exprOtherwise",
                        "label": "BuildDeploymentInfo to CopyOfPublishDeploymentStatus"
                    }
                ],
                "tasks": [
                    {
                        "id": "LogDeployment",
                        "name": "LogDeployment",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:LogDeployment %%%%% Delete : \", coerce.toString($flow.Delete), \", ID : \", $flow.ID, \", Type : \", $flow.Type, \", Location : \", $flow.Location, \", URL : \", $flow.URL)"
                            }
                        }
                    },
                    {
                        "id": "BuildDeploymentInfo",
                        "name": "BuildDeploymentInfo",
                        "description": "JSON Serializer Activity",
                        "activity": {
                            "ref": "#jsonserializer",
                            "settings": {
                                "schemaFromfile": false,
                                "sample": "",
                                "dataSample": {
                                    "metadata": "{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"ID\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"},\"Location\":{\"type\":\"string\"},\"URL\":{\"type\":\"string\"},\"Properties\":{\"type\":\"object\",\"properties\":{}}}}",
                                    "value": "",
                                    "fe_metadata": "{\n    \"ID\": \"\",\n    \"Type\": \"\",\n    \"Location\": \"\",\n    \"URL\": \"\",\n    \"Properties\": {}\n}"
                                }
                            },
                            "input": {
                                "Data": {
                                    "mapping": {
                                        "ID": "=$flow.ID",
                                        "Type": "=$flow.Type",
                                        "URL": "=$flow.URL",
                                        "Properties": "=f1.combineobjs($flow.Properties, f1.json2object(\"{ \\\"Reporter\\\": \\\"Air\\\", \\\"LastModified\\\": 1637625074}\"))",
                                        "Location": "=$flow.Location"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "LogUpdateDeployment",
                        "name": "LogUpdateDeployment",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:Update Deployment %%%%% Request To LightcraneService : ID : \", $flow.ID, \", Type : \", $flow.Type, \", Location : \", $flow.Location, \", URL : \", $flow.URL, \", Delete : \", coerce.toString($flow.Delete), \", Properties : \", coerce.toString($flow.Properties))"
                            }
                        }
                    },
                    {
                        "id": "PublishDeploymentStatus",
                        "name": "PublishDeploymentStatus",
                        "description": "This activity build docker image from Dockerfile",
                        "activity": {
                            "ref": "#httpclient",
                            "settings": {
                                "method": "POST",
                                "timeout": "1000",
                                "urlMappingString": "",
                                "leftToken": "%",
                                "rightToken": "%",
                                "variablesDef": "[{\"Name\":\"ServiceLocatorIP\",\"Type\":\"String\"},{\"Name\":\"ServiceType\",\"Type\":\"String\"}]"
                            },
                            "input": {
                                "URL": "http://%ServiceLocatorIP%:10080/f1/locator/register/%ServiceType%",
                                "Body": "=$activity[BuildDeploymentInfo].JSONString",
                                "SkipCondition": false,
                                "Variables": {
                                    "mapping": {
                                        "ServiceLocatorIP": "=$property[\"System.ServiceLocatorIP\"]",
                                        "ServiceType": "deployment"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "UnregisterDeployment",
                        "name": "UnregisterDeployment",
                        "description": "This activity build docker image from Dockerfile",
                        "activity": {
                            "ref": "#httpclient",
                            "settings": {
                                "method": "POST",
                                "timeout": "1000",
                                "urlMappingString": "",
                                "leftToken": "%",
                                "rightToken": "%",
                                "variablesDef": "[{\"Name\":\"ServiceLocatorIP\",\"Type\":\"String\"},{\"Name\":\"ServiceType\",\"Type\":\"String\"}]"
                            },
                            "input": {
                                "URL": "http://%ServiceLocatorIP%:10080/f1/locator/unregister/%ServiceType%",
                                "Body": "=$activity[BuildDeploymentInfo].JSONString",
                                "SkipCondition": false,
                                "Variables": {
                                    "mapping": {
                                        "ServiceLocatorIP": "=$property[\"System.ServiceLocatorIP\"]",
                                        "ServiceType": "deployment"
                                    }
                                }
                            },
                            "output": {
                                "Success": false
                            }
                        }
                    }
                ],
                "metadata": {
                    "input": [
                        {
                            "name": "Delete",
                            "type": "boolean"
                        },
                        {
                            "name": "ID",
                            "type": "string"
                        },
                        {
                            "name": "Type",
                            "type": "string"
                        },
                        {
                            "name": "Location",
                            "type": "string"
                        },
                        {
                            "name": "URL",
                            "type": "string"
                        },
                        {
                            "name": "Properties",
                            "type": "object"
                        }
                    ],
                    "output": []
                }
            }
        },
        {
            "id": "flow:Build_Model_Service",
            "data": {
                "name": "Build Model Service",
                "description": "**** Build ML model service ****",
                "links": [
                    {
                        "id": 1,
                        "from": "LogMessage",
                        "to": "SetSystemProperties",
                        "type": "default"
                    },
                    {
                        "id": 2,
                        "from": "SetSystemProperties",
                        "to": "NoAppDescriptor",
                        "type": "expression",
                        "label": "SetSystemPropertiestoBuildFlogoPipeline",
                        "value": "true==f1.isnull($flow.ModelDescriptor)"
                    },
                    {
                        "id": 3,
                        "from": "SetSystemProperties",
                        "to": "LogBuildFlogoApp",
                        "type": "exprOtherwise",
                        "label": "SetSystemPropertiestoCopyOfReturn2"
                    },
                    {
                        "id": 4,
                        "from": "LogBuildFlogoApp",
                        "to": "BuildModelService",
                        "type": "default"
                    },
                    {
                        "id": 5,
                        "from": "BuildModelService",
                        "to": "PropertyNameDef2",
                        "type": "default"
                    },
                    {
                        "id": 6,
                        "from": "PropertyNameDef2",
                        "to": "WriterPropertyNameDef2",
                        "type": "default"
                    },
                    {
                        "id": 7,
                        "from": "WriterPropertyNameDef2",
                        "to": "FlogoDescriptorStr2",
                        "type": "default"
                    },
                    {
                        "id": 8,
                        "from": "FlogoDescriptorStr2",
                        "to": "BuildRequest2",
                        "type": "default"
                    },
                    {
                        "id": 9,
                        "from": "BuildRequest2",
                        "to": "ToBuild2",
                        "type": "default"
                    },
                    {
                        "id": 10,
                        "from": "ToBuild2",
                        "to": "Return_Flogo",
                        "type": "default"
                    }
                ],
                "tasks": [
                    {
                        "id": "LogMessage",
                        "name": "LogMessage",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:BuildAirPipeline %%%%% SyncBuild : \", coerce.toString($flow.SyncBuild), \", ProjectID : \", $flow.ProjectID, \", ComponentType : \", $flow.ComponentType, \", ServiceType : \", $flow.ServiceType, \", Name : \", $flow.Name, \", Image : \", $flow.Image, \", ScriptSystemEnv : \", coerce.toString($flow.ScriptSystemEnv))"
                            }
                        }
                    },
                    {
                        "id": "SetSystemProperties",
                        "name": "SetSystemProperties",
                        "description": "Mapping field from input to output",
                        "activity": {
                            "ref": "#mapping",
                            "settings": {
                                "IsArray": false,
                                "MappingFields": "[{\"Name\":\"SyncBuild\",\"Type\":\"Boolean\"},{\"Name\":\"BuilderURL\",\"Type\":\"String\"},{\"Name\":\"PropertyNameDefFilename\",\"Type\":\"String\"},{\"Name\":\"Location\",\"Type\":\"String\"},{\"Name\":\"ScriptSystemEnv\",\"Type\":\"Object\"}]"
                            },
                            "input": {
                                "Mapping": {
                                    "mapping": {
                                        "SyncBuild": "=f1.ternary(null!=$flow.SyncBuild, $flow.SyncBuild, false)",
                                        "SkipCondition": false,
                                        "BuilderURL": "=$property[\"System.BuilderURL\"]",
                                        "PropertyNameDefFilename": "=$property[\"System.BaseFolder\"] + \"/projects/\" + $flow.ProjectID + \"/pipeline/\" + $flow.Name + \"_property_name_def.json\"",
                                        "Location": "=f1.ternary(\"\"==coerce.toString(f1.getsubobject($flow.ScriptSystemEnv, \"TargetServer\")), \"localhost\", coerce.toString(f1.getsubobject($flow.ScriptSystemEnv, \"TargetServer\")))",
                                        "ScriptSystemEnv": "=f1.modifyobject($flow.ScriptSystemEnv, \"SkipBuild\", false)"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "NoAppDescriptor",
                        "name": "NoAppDescriptor",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Success": false,
                                    "Message": "No Application Descriptor!",
                                    "ErrorCode": 300
                                }
                            }
                        }
                    },
                    {
                        "id": "LogBuildFlogoApp",
                        "name": "LogBuildFlogoApp",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:BuildModelService %%%%% ModelDescriptor : \", coerce.toString($flow.ModelDescriptor))"
                            }
                        }
                    },
                    {
                        "id": "BuildModelService",
                        "name": "BuildModelService",
                        "description": "Simple SubFlow Activity",
                        "activity": {
                            "ref": "#subflow",
                            "settings": {
                                "flowURI": "res://flow:Build_Deploy_Desc"
                            },
                            "input": {
                                "ProjectID": "=$flow.ProjectID",
                                "SyncBuild": "=$flow.SyncBuild",
                                "ComponentType": "=$flow.ComponentType",
                                "ServiceType": "=$flow.ServiceType",
                                "Name": "=$flow.Name",
                                "Image": "=$flow.Image",
                                "ScriptSystemEnv": "=$activity[SetSystemProperties].Data.ScriptSystemEnv",
                                "ModelDescriptor": "=$flow.ModelDescriptor"
                            }
                        }
                    },
                    {
                        "id": "PropertyNameDef2",
                        "name": "PropertyNameDef2",
                        "description": "Object Serializer Activity",
                        "activity": {
                            "ref": "#objectserializer",
                            "settings": {
                                "StringFormat": "json",
                                "PassThrough": ""
                            },
                            "input": {
                                "Data": "=$activity[BuildModelService].PropertyNameDef"
                            }
                        }
                    },
                    {
                        "id": "WriterPropertyNameDef2",
                        "name": "WriterPropertyNameDef2",
                        "description": "This activity write incoming object to file system",
                        "activity": {
                            "ref": "#filewriter",
                            "settings": {
                                "inputType": "String",
                                "outputFile": "$Filename$",
                                "leftToken": "$",
                                "rightToken": "$",
                                "variablesDef": "[{\"Name\":\"Filename\",\"Type\":\"String\"}]"
                            },
                            "input": {
                                "SkipCondition": false,
                                "Data": {
                                    "mapping": {
                                        "Input": "=$activity[PropertyNameDef2].SerializedString"
                                    }
                                },
                                "Variables": {
                                    "mapping": {
                                        "Filename": "=$activity[SetSystemProperties].Data.PropertyNameDefFilename"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "FlogoDescriptorStr2",
                        "name": "FlogoDescriptorStr2",
                        "description": "Object Serializer Activity",
                        "activity": {
                            "ref": "#objectserializer",
                            "settings": {
                                "StringFormat": "json",
                                "PassThrough": ""
                            },
                            "input": {
                                "Data": "=$activity[BuildModelService].Descriptor"
                            }
                        }
                    },
                    {
                        "id": "BuildRequest2",
                        "name": "BuildRequest2",
                        "description": "JSON Serializer Activity",
                        "activity": {
                            "ref": "#jsonserializer",
                            "settings": {
                                "schemaFromfile": false,
                                "sample": "",
                                "dataSample": {
                                    "metadata": "{\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n    \"type\": \"object\",\n    \"properties\": {\n        \"SyncBuild\": {\n            \"type\": \"boolean\"\n        },\n        \"ComponentType\": {\n            \"type\": \"string\"\n        },\n        \"Runner\": {\n            \"type\": \"string\"\n        },\n        \"Image\": {\n            \"type\": \"string\"\n        },\n        \"DeployDescriptor\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"Type\": {\n                    \"type\": \"string\"\n                },\n                \"Name\": {\n                    \"type\": \"string\"\n                },\n                \"Descriptor\": {\n                    \"type\": \"string\"\n                },\n                \"Variables\": {\n                    \"type\": \"object\",\n                    \"properties\": {}\n                },\n                \"ScriptSystemEnv\": {\n                    \"type\": \"object\",\n                    \"properties\": {}\n                },\n                \"Properties\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"Group\": {\n                                \"type\": \"string\"\n                            },\n                            \"Value\": {\n                                \"type\": \"array\",\n                                \"items\": {\n                                    \"type\": \"object\",\n                                    \"properties\": {\n                                        \"Name\": {\n                                            \"type\": \"string\"\n                                        },\n                                        \"Value\": {\n                                            \"type\": \"string\"\n                                        },\n                                        \"Type\": {\n                                            \"type\": \"string\"\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}",
                                    "value": ""
                                }
                            },
                            "input": {
                                "Data": {
                                    "mapping": {
                                        "DeployDescriptor": {
                                            "Type": "=$flow.ServiceType",
                                            "Name": "=$flow.Name",
                                            "ScriptSystemEnv": "=$activity[SetSystemProperties].Data.ScriptSystemEnv",
                                            "Properties": "=$activity[BuildModelService].Descriptor.properties",
                                            "Descriptor": "=$activity[BuildModelService].Descriptor.DeployDescriptor"
                                        },
                                        "SyncBuild": "=$activity[SetSystemProperties].Data.SyncBuild",
                                        "ComponentType": "=$flow.ComponentType",
                                        "Image": "=$flow.Image",
                                        "Runner": "=$flow.ModelDescriptor.Runner"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "ToBuild2",
                        "name": "ToBuild2",
                        "description": "Simple SubFlow Activity",
                        "activity": {
                            "ref": "#subflow",
                            "settings": {
                                "flowURI": "res://flow:Call_Lightcrane_Service"
                            },
                            "input": {
                                "ServiceURL": "=$activity[SetSystemProperties].Data.BuilderURL + \"/f1/builder/buildDocker/\" + $flow.ProjectID",
                                "RequestBody": "=$activity[BuildRequest2].JSONString",
                                "ProjectID": "=$flow.ProjectID",
                                "Name": "=$flow.Name",
                                "Properties": {
                                    "mapping": {
                                        "Status": "Building"
                                    }
                                },
                                "Location": "=$activity[SetSystemProperties].Data.Location"
                            }
                        }
                    },
                    {
                        "id": "Return_Flogo",
                        "name": "Return_Flogo",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Success": "=$activity[ToBuild2].Success",
                                    "Message": "=$activity[ToBuild2].Message",
                                    "ErrorCode": "=$activity[ToBuild2].ErrorCode"
                                }
                            }
                        }
                    }
                ],
                "errorHandler": {
                    "tasks": [
                        {
                            "id": "Return_Error",
                            "name": "Return_Error",
                            "description": "Simple Return Activity",
                            "activity": {
                                "ref": "#actreturn",
                                "settings": {
                                    "mappings": {
                                        "Success": false,
                                        "ErrorCode": 400,
                                        "Message": "=string.concat(\"AirService::Build Pipeline - \", $error.message)"
                                    }
                                }
                            }
                        }
                    ],
                    "links": []
                },
                "metadata": {
                    "input": [
                        {
                            "name": "ProjectID",
                            "type": "string"
                        },
                        {
                            "name": "SyncBuild",
                            "type": "boolean"
                        },
                        {
                            "name": "ComponentType",
                            "type": "string"
                        },
                        {
                            "name": "ServiceType",
                            "type": "string"
                        },
                        {
                            "name": "Name",
                            "type": "string"
                        },
                        {
                            "name": "Image",
                            "type": "string"
                        },
                        {
                            "name": "ModelDescriptor",
                            "type": "object",
                            "schema": {
                                "type": "json",
                                "value": "{\"source\":{\"type\":\"object\",\"properties\":{}},\"logic\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"artifacts\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Filename\":{\"type\":\"string\"},\"Content\":{\"type\":\"string\"},\"Encoded\":{\"type\":\"boolean\"}}}},\"properties\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"}},\"required\":[\"Name\",\"Value\"]}},\"ports\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}}}}},\"extra\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"}},\"required\":[\"Name\",\"Value\"]}}}"
                            }
                        },
                        {
                            "name": "ScriptSystemEnv",
                            "type": "object"
                        }
                    ],
                    "output": [
                        {
                            "name": "Success",
                            "type": "boolean"
                        },
                        {
                            "name": "Message",
                            "type": "string"
                        },
                        {
                            "name": "ErrorCode",
                            "type": "float64"
                        }
                    ]
                },
                "explicitReply": true
            }
        },
        {
            "id": "flow:Validate_a_model_descriptor_then_convert_to_Flogo_descriptor",
            "data": {
                "name": "Validate a model descriptor then convert to Flogo descriptor",
                "description": "**** Only for flogo pipeline ****",
                "links": [
                    {
                        "id": 1,
                        "from": "LogMessage",
                        "to": "BuildAppPipelineDescriptor",
                        "type": "expression",
                        "label": "LogMessagetoBuildAppPipelineDescriptor",
                        "value": "null==$flow.AirDescriptor.logic[0].flogoApp"
                    },
                    {
                        "id": 2,
                        "from": "BuildAppPipelineDescriptor",
                        "to": "AirK8sAppBuilder",
                        "type": "expression",
                        "label": "BuildAppPipelineDescriptortoAirApplicationBuilder",
                        "value": "\"k8s\" == $flow.ServiceType"
                    },
                    {
                        "id": 3,
                        "from": "AirK8sAppBuilder",
                        "to": "Return01",
                        "type": "default"
                    },
                    {
                        "id": 4,
                        "from": "BuildAppPipelineDescriptor",
                        "to": "AirDockerComposeAppBuilder",
                        "type": "exprOtherwise",
                        "label": "BuildAppPipelineDescriptor to CopyOfAirApplicationBuilder"
                    },
                    {
                        "id": 5,
                        "from": "AirDockerComposeAppBuilder",
                        "to": "Return02",
                        "type": "default"
                    },
                    {
                        "id": 6,
                        "from": "LogMessage",
                        "to": "Return04",
                        "type": "exprOtherwise",
                        "label": "LogMessagetoReturn04"
                    }
                ],
                "tasks": [
                    {
                        "id": "LogMessage",
                        "name": "LogMessage",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:ValidateAirPipeline %%%%% SyncBuild : \", coerce.toString($flow.SyncBuild), \", ProjectID : \", $flow.ProjectID, \", ComponentType : \", $flow.ComponentType, \", ServiceType : \", $flow.ServiceType, \", Name : \", $flow.Name, \", Image : \", $flow.Image, \", AirDescriptor : \", coerce.toString($flow.AirDescriptor), \", ScriptSystemEnv : \", coerce.toString($flow.ScriptSystemEnv))"
                            }
                        }
                    },
                    {
                        "id": "BuildAppPipelineDescriptor",
                        "name": "BuildAppPipelineDescriptor",
                        "description": "JSON Serializer Activity",
                        "activity": {
                            "ref": "#jsonserializer",
                            "settings": {
                                "schemaFromfile": false,
                                "sample": "",
                                "dataSample": {
                                    "metadata": "{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"properties\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}}}},\"source\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"properties\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}}}},\"ports\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}}}},\"logic\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"properties\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}}}}}}},\"extra\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"}}}}}}",
                                    "value": "",
                                    "fe_metadata": "{\n        \"properties\" : [\n            {\"Name\" : \"\", \"Value\":\"\", \"Type\":\"\"}\n        ],\n        \"source\": {\n            \"name\": \"MQTT\",\n            \"properties\" : [\n                {\"Name\" : \"\", \"Value\":\"\", \"Type\":\"\"}\n            ],\n            \"ports\" : [\n                \"8080:9999\"\n            ]\n        },\n        \"logic\": [\n            {\n                \"name\": \"Dgraph\",\n                \"properties\" : [\n                    {\"Name\" : \"\", \"Value\":\"\", \"Type\":\"\"}\n                ]\n            }\n        ],\n        \"extra\": [\n            {\"Name\":\"networks.default.external.name\", \"Value\":\"edgex-network\"}\n        ]\n    }"
                                }
                            },
                            "input": {
                                "Data": {
                                    "mapping": {
                                        "source": {
                                            "name": "=$flow.AirDescriptor.source.name",
                                            "properties": "=$flow.AirDescriptor.source.properties",
                                            "ports": "=$flow.AirDescriptor.source.ports"
                                        },
                                        "logic": "=$flow.AirDescriptor.logic",
                                        "properties": "=array.create(f1.json2object(\"{\\\"Name\\\":\\\"FLOGO_APP_PROPS_ENV\\\",\\\"Value\\\":\\\"auto\\\"}\"))",
                                        "extra": "=$flow.AirDescriptor.extra"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "AirK8sAppBuilder",
                        "name": "AirK8sAppBuilder",
                        "description": "This activity build model inference pipeline",
                        "activity": {
                            "ref": "#airpipelinebuilder",
                            "settings": {
                                "TemplateFolder": "/home/airpipeline",
                                "leftToken": "$",
                                "rightToken": "$",
                                "variablesDef": "[{\"Name\":\"Name\",\"Type\":\"String\"},{\"Name\":\"ImageName\",\"Type\":\"String\"}]",
                                "Properties": "[{\"Name\":\"main_apiVersion\",\"Value\":\"apps/v1\"},{\"Name\":\"main_kind\",\"Value\":\"Deployment\"},{\"Name\":\"main_metadata.name\",\"Value\":\"$Name$\"},{\"Name\":\"main_spec.template.spec.containers[0].image\",\"Value\":\"$ImageName$\"},{\"Name\":\"main_spec.template.spec.containers[0].name\",\"Value\":\"$Name$\"},{\"Name\":\"main_spec.selector.matchLabels.component\",\"Value\":\"$Name$\"},{\"Name\":\"main_spec.template.metadata.labels.component\",\"Value\":\"$Name$\"},{\"Name\":\"ip-service_apiVersion\",\"Value\":\"v1\"},{\"Name\":\"ip-service_kind\",\"Value\":\"Service\"},{\"Name\":\"ip-service_metadata.name\",\"Value\":\"$Name$-ip-service\"},{\"Name\":\"ip-service_spec.selector.component\",\"Value\":\"$Name$\"},{\"Name\":\"ip-service_spec.type\",\"Value\":\"LoadBalancer\"}]"
                            },
                            "input": {
                                "ApplicationName": "=$flow.Name",
                                "AirDescriptor": "=$activity[BuildAppPipelineDescriptor].JSONString",
                                "ServiceType": "=$flow.ServiceType",
                                "PropertyPrefix": "spec.template.spec.containers[0]",
                                "Variables": {
                                    "mapping": {
                                        "Name": "=$flow.Name",
                                        "ImageName": "=$flow.Image"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "Return01",
                        "name": "Return01",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Success": true,
                                    "Message": "AirService::Validate Pipeline - done",
                                    "ErrorCode": 100,
                                    "PropertyNameDef": "=$activity[AirK8sAppBuilder].PropertyNameDef",
                                    "Descriptor": {
                                        "mapping": {
                                            "FlogoDescriptor": "=$activity[AirK8sAppBuilder].Descriptor.FlogoDescriptor",
                                            "properties": "=$activity[AirK8sAppBuilder].Descriptor.F1Properties",
                                            "DeployDescriptor": "=$property[\"Descriptor.k8s\"]"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "AirDockerComposeAppBuilder",
                        "name": "AirDockerComposeAppBuilder",
                        "description": "This activity build model inference pipeline",
                        "activity": {
                            "ref": "#airpipelinebuilder",
                            "settings": {
                                "TemplateFolder": "/home/airpipeline",
                                "leftToken": "$",
                                "rightToken": "$",
                                "variablesDef": "[{\"Name\":\"Name\",\"Type\":\"String\"},{\"Name\":\"ContainerName\",\"Type\":\"String\"},{\"Name\":\"ImageName\",\"Type\":\"String\"},{\"Name\":\"BuildName\",\"Type\":\"String\"}]",
                                "Properties": "[{\"Name\":\"version\",\"Value\":\"3.6\"},{\"Name\":\"services.$Name$.container_name\",\"Value\":\"$ContainerName$\"},{\"Name\":\"services.$Name$.image\",\"Value\":\"$ImageName$\"},{\"Name\":\"services.$Name$.build\",\"Value\":\"$BuildName$\"}]"
                            },
                            "input": {
                                "ApplicationName": "=$flow.Name",
                                "AirDescriptor": "=$activity[BuildAppPipelineDescriptor].JSONString",
                                "ServiceType": "=$flow.ServiceType",
                                "PropertyPrefix": "services.$Name$",
                                "Variables": {
                                    "mapping": {
                                        "Name": "=$flow.Name",
                                        "ContainerName": "=$flow.ProjectID+\"_\"+$flow.Name",
                                        "ImageName": "=$flow.Image",
                                        "BuildName": "=f1.ternary(null==$flow.Image||\"\"==$flow.Image, \"001\", \"\")"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "Return02",
                        "name": "Return02",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Success": true,
                                    "Message": "AirService::Validate Pipeline - done",
                                    "ErrorCode": 100,
                                    "PropertyNameDef": "=$activity[AirDockerComposeAppBuilder].PropertyNameDef",
                                    "Descriptor": {
                                        "mapping": {
                                            "FlogoDescriptor": "=$activity[AirDockerComposeAppBuilder].Descriptor.FlogoDescriptor",
                                            "properties": "=$activity[AirDockerComposeAppBuilder].Descriptor.F1Properties",
                                            "DeployDescriptor": "=$property[\"Descriptor.docker\"]"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "Return04",
                        "name": "Return04",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Success": true,
                                    "Message": "AirService::Skip validate Flogo app - done",
                                    "ErrorCode": 100,
                                    "Descriptor": {
                                        "mapping": {
                                            "FlogoDescriptor": "=$flow.AirDescriptor.logic[0].flogoApp"
                                        }
                                    }
                                }
                            }
                        }
                    }
                ],
                "errorHandler": {
                    "tasks": [
                        {
                            "id": "Return03",
                            "name": "Return03",
                            "description": "Simple Return Activity",
                            "activity": {
                                "ref": "#actreturn",
                                "settings": {
                                    "mappings": {
                                        "Success": false,
                                        "ErrorCode": 400,
                                        "Message": "=string.concat(\"AirService::Validate Pipeline - \", $error.message)"
                                    }
                                }
                            }
                        }
                    ],
                    "links": []
                },
                "metadata": {
                    "input": [
                        {
                            "name": "ProjectID",
                            "type": "string"
                        },
                        {
                            "name": "SyncBuild",
                            "type": "boolean"
                        },
                        {
                            "name": "ComponentType",
                            "type": "string"
                        },
                        {
                            "name": "ServiceType",
                            "type": "string"
                        },
                        {
                            "name": "Name",
                            "type": "string"
                        },
                        {
                            "name": "Image",
                            "type": "string"
                        },
                        {
                            "name": "AirDescriptor",
                            "type": "object",
                            "schema": {
                                "type": "json",
                                "value": "{\"source\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"properties\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}}}},\"ports\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}}}},\"logic\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"flogoApp\":{\"type\":\"string\"},\"properties\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}}}},\"ports\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}}}}},\"extra\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}}}}}"
                            }
                        },
                        {
                            "name": "ScriptSystemEnv",
                            "type": "object"
                        }
                    ],
                    "output": [
                        {
                            "name": "Success",
                            "type": "boolean"
                        },
                        {
                            "name": "Message",
                            "type": "string"
                        },
                        {
                            "name": "ErrorCode",
                            "type": "float64"
                        },
                        {
                            "name": "Descriptor",
                            "type": "object",
                            "schema": {
                                "type": "json",
                                "value": "{\"FlogoDescriptor\":{\"type\":\"string\"},\"properties\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{}}},\"DeployDescriptor\":{\"type\":\"string\"}}"
                            }
                        },
                        {
                            "name": "PropertyNameDef",
                            "type": "object"
                        }
                    ]
                },
                "explicitReply": true
            }
        },
        {
            "id": "flow:Build_and_Deploy_ML_Model_Service",
            "data": {
                "name": "Build and Deploy ML Model Service",
                "description": "**** The entry point for project air UI ****",
                "links": [
                    {
                        "id": 1,
                        "from": "LogMessage",
                        "to": "NoAppDescriptor",
                        "type": "expression",
                        "label": "LogMessagetoReturn6",
                        "value": "null==$flow.ModelDescriptor"
                    },
                    {
                        "id": 2,
                        "from": "LogMessage",
                        "to": "SetSystemProperties",
                        "type": "exprOtherwise",
                        "label": "LogMessage to SetSystemProperties"
                    },
                    {
                        "id": 3,
                        "from": "SetSystemProperties",
                        "to": "CreateProject",
                        "type": "label",
                        "label": "SetSystemPropertiestoAddTask"
                    },
                    {
                        "id": 4,
                        "from": "CreateProject",
                        "to": "AddTask",
                        "type": "default"
                    },
                    {
                        "id": 5,
                        "from": "AddTask",
                        "to": "BuildFlogo",
                        "type": "default"
                    },
                    {
                        "id": 6,
                        "from": "BuildFlogo",
                        "to": "BuildSuccessfully",
                        "type": "expression",
                        "label": "BuildPipelinetoReturn4",
                        "value": "$activity[BuildFlogo].Success"
                    },
                    {
                        "id": 7,
                        "from": "BuildFlogo",
                        "to": "RemoveTask",
                        "type": "exprOtherwise",
                        "label": "BuildPipelinetoTableMutate"
                    },
                    {
                        "id": 8,
                        "from": "RemoveTask",
                        "to": "BuildFailed",
                        "type": "default"
                    }
                ],
                "tasks": [
                    {
                        "id": "LogMessage",
                        "name": "LogMessage",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:BuildAndDeployAirPipeline %%%%% SyncBuild : \", coerce.toString($flow.SyncBuild), \", ProjectID : \", $flow.ProjectID, \", ComponentType : \", $flow.ComponentType, \", ServiceType : \", $flow.ServiceType, \", Name : \", $flow.Name, \", Image : \", $flow.Image, \", ModelDescriptor : \", coerce.toString($flow.ModelDescriptor), \", ScriptSystemEnv : \", coerce.toString($flow.ScriptSystemEnv))"
                            }
                        }
                    },
                    {
                        "id": "NoAppDescriptor",
                        "name": "NoAppDescriptor",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Success": false,
                                    "Message": "No Application Descriptor!",
                                    "ErrorCode": 300
                                }
                            }
                        }
                    },
                    {
                        "id": "SetSystemProperties",
                        "name": "SetSystemProperties",
                        "description": "Mapping field from input to output",
                        "activity": {
                            "ref": "#mapping",
                            "settings": {
                                "IsArray": false,
                                "MappingFields": "[{\"Name\":\"SyncBuild\",\"Type\":\"Boolean\"},{\"Name\":\"BuilderURL\",\"Type\":\"String\"},{\"Name\":\"PropertyNameDefFilename\",\"Type\":\"String\"},{\"Name\":\"ExtraProperties\",\"Type\":\"Array\"}]"
                            },
                            "input": {
                                "Mapping": {
                                    "mapping": {
                                        "SyncBuild": "=f1.ternary(null!=$flow.SyncBuild, $flow.SyncBuild, false)",
                                        "SkipCondition": false,
                                        "BuilderURL": "=$property[\"System.BuilderURL\"]",
                                        "PropertyNameDefFilename": "=$property[\"System.BaseFolder\"] + \"/projects/\" + $flow.ProjectID + \"/pipeline/\" + $flow.Name + \"_property_name_def.json\"",
                                        "ExtraProperties": "=$flow.ModelDescriptor.extra"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "CreateProject",
                        "name": "CreateProject",
                        "description": "Simple SubFlow Activity",
                        "activity": {
                            "ref": "#subflow",
                            "settings": {
                                "flowURI": "res://flow:Create_Project"
                            },
                            "input": {
                                "ProjectID": "=$flow.ProjectID",
                                "artifacts": "=$flow.artifacts"
                            }
                        }
                    },
                    {
                        "id": "AddTask",
                        "name": "AddTask",
                        "description": "A simple activity for upserting data to table",
                        "activity": {
                            "ref": "#tableupsert",
                            "settings": {
                                "Table": {
                                    "id": "9e35d4b0-6eeb-11eb-90dc-41e63340b2bf",
                                    "type": "flogo:connector",
                                    "version": "1.0.0",
                                    "name": "tibco-simple-table",
                                    "hashTags": [],
                                    "inputMappings": {},
                                    "outputMappings": {},
                                    "iteratorMappings": {},
                                    "title": "Simple Table",
                                    "description": "This is URL file reader",
                                    "ref": "github.com/TIBCOSoftware/GraphBuilder_Tools/connector/simpletable",
                                    "settings": [
                                        {
                                            "name": "name",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Name",
                                                "description": "Name of the table instance"
                                            },
                                            "value": "AirTask"
                                        },
                                        {
                                            "name": "description",
                                            "type": "string",
                                            "display": {
                                                "name": "Description",
                                                "description": "A simple table for storing tuple"
                                            },
                                            "value": ""
                                        },
                                        {
                                            "name": "schema",
                                            "type": "array",
                                            "required": true,
                                            "display": {
                                                "name": "Table Schema",
                                                "description": "Schema of the table",
                                                "type": "table",
                                                "schema": "{\r\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\r\n    \"definitions\": {},\r\n    \"id\": \"http://example.com/example.json\",\r\n    \"items\": {\r\n        \"id\": \"/items\",\r\n        \"properties\": {\r\n            \"Name\": {\r\n                \"id\": \"/items/properties/Name\",\r\n                \"type\": \"string\"\r\n            },\r\n            \"Type\": {\r\n                \"id\": \"/items/properties/Type\",\r\n                \"type\": {\"enum\":[\"String\", \"Integer\", \"Long\", \"Double\", \"Boolean\", \"Date\", \"Object\"]}\r\n            },\r\n            \"IsKey\": {\r\n                \"id\": \"/items/properties/IsKey\",\r\n                \"type\": {\"enum\":[\"no\", \"yes\"]}\r\n            },\r\n            \"Indexed\": {\r\n                \"id\": \"/items/properties/Indexed\",\r\n                \"type\": {\"enum\":[\"no\", \"yes\"]}\r\n            }\r\n        },\r\n        \"type\": \"object\"\r\n    },\r\n    \"type\": \"array\"\r\n}"
                                            },
                                            "value": "[{\"Name\":\"ProjectID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"Name\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"Data\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Status\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"LastModified\",\"Type\":\"Long\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"ErrorCode\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"ErrorMessage\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"}]"
                                        }
                                    ],
                                    "outputs": [],
                                    "inputs": [],
                                    "handler": {
                                        "settings": []
                                    },
                                    "reply": [],
                                    "s3Prefix": "flogo",
                                    "key": "flogo/GraphBuilder_Tools/connector/simpletable/connector.json",
                                    "display": {
                                        "description": "This is URL file reader",
                                        "category": "GraphBuilder_Tools",
                                        "visible": true,
                                        "smallIcon": "simpletable.png"
                                    },
                                    "actions": [
                                        {
                                            "name": "create",
                                            "display": {
                                                "name": "Create",
                                                "readonly": false,
                                                "valid": true,
                                                "visible": true
                                            }
                                        }
                                    ],
                                    "feature": {},
                                    "loopType": "none",
                                    "loopSettings": [],
                                    "retrySettings": [],
                                    "propertyMap": {},
                                    "keyfield": "name",
                                    "schemaMap": {},
                                    "iteratorAccumulate": false,
                                    "isValid": true,
                                    "lastUpdatedTime": 1636482504177,
                                    "user": "flogo",
                                    "connectorName": "AirTask",
                                    "connectorDescription": " "
                                }
                            },
                            "input": {
                                "Mapping": {
                                    "mapping": {
                                        "ProjectID": "=$flow.ProjectID",
                                        "Name": "=$flow.Name",
                                        "Data": "=f1.modifyobject(f1.modifyobject(f1.json2object(\"{}\"), \"ScriptSystemEnv\" , $flow.ScriptSystemEnv), \"Extra\", $activity[SetSystemProperties].Data.ExtraProperties)"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "BuildFlogo",
                        "name": "BuildFlogo",
                        "description": "Simple SubFlow Activity",
                        "activity": {
                            "ref": "#subflow",
                            "settings": {
                                "flowURI": "res://flow:Build_Model_Service"
                            },
                            "input": {
                                "ProjectID": "=$flow.ProjectID",
                                "SyncBuild": "=$flow.SyncBuild",
                                "ComponentType": "=$flow.ComponentType",
                                "ServiceType": "=$flow.ServiceType",
                                "Name": "=$flow.Name",
                                "Image": "=$flow.Image",
                                "ScriptSystemEnv": "=f1.modifyobject($flow.ScriptSystemEnv, \"RSVPUrl\", \"http://modelservice:10097/f1/modelservice/rsvp/\"+$flow.ProjectID+\"/\"+$flow.Name)",
                                "ModelDescriptor": {
                                    "mapping": {
                                        "Runner": "=$flow.ModelDescriptor.Runner",
                                        "properties": "=$flow.ModelDescriptor.properties",
                                        "ports": "=$flow.ModelDescriptor.ports",
                                        "extra": "=f1.combineproperties($flow.ModelDescriptor.extra, $activity[CreateProject].Extra)"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "BuildSuccessfully",
                        "name": "BuildSuccessfully",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Success": "=$activity[BuildFlogo].Success",
                                    "Message": "=$activity[BuildFlogo].Message",
                                    "ErrorCode": "=$activity[BuildFlogo].ErrorCode"
                                }
                            }
                        }
                    },
                    {
                        "id": "RemoveTask",
                        "name": "RemoveTask",
                        "description": "A simple activity for upserting/deleting data to/from table",
                        "activity": {
                            "ref": "#tablemutate",
                            "settings": {
                                "Table": {
                                    "id": "9e35d4b0-6eeb-11eb-90dc-41e63340b2bf",
                                    "type": "flogo:connector",
                                    "version": "1.0.0",
                                    "name": "tibco-simple-table",
                                    "hashTags": [],
                                    "inputMappings": {},
                                    "outputMappings": {},
                                    "iteratorMappings": {},
                                    "title": "Simple Table",
                                    "description": "This is URL file reader",
                                    "ref": "github.com/TIBCOSoftware/GraphBuilder_Tools/connector/simpletable",
                                    "settings": [
                                        {
                                            "name": "name",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Name",
                                                "description": "Name of the table instance"
                                            },
                                            "value": "AirTask"
                                        },
                                        {
                                            "name": "description",
                                            "type": "string",
                                            "display": {
                                                "name": "Description",
                                                "description": "A simple table for storing tuple"
                                            },
                                            "value": ""
                                        },
                                        {
                                            "name": "schema",
                                            "type": "array",
                                            "required": true,
                                            "display": {
                                                "name": "Table Schema",
                                                "description": "Schema of the table",
                                                "type": "table",
                                                "schema": "{\r\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\r\n    \"definitions\": {},\r\n    \"id\": \"http://example.com/example.json\",\r\n    \"items\": {\r\n        \"id\": \"/items\",\r\n        \"properties\": {\r\n            \"Name\": {\r\n                \"id\": \"/items/properties/Name\",\r\n                \"type\": \"string\"\r\n            },\r\n            \"Type\": {\r\n                \"id\": \"/items/properties/Type\",\r\n                \"type\": {\"enum\":[\"String\", \"Integer\", \"Long\", \"Double\", \"Boolean\", \"Date\", \"Object\"]}\r\n            },\r\n            \"IsKey\": {\r\n                \"id\": \"/items/properties/IsKey\",\r\n                \"type\": {\"enum\":[\"no\", \"yes\"]}\r\n            },\r\n            \"Indexed\": {\r\n                \"id\": \"/items/properties/Indexed\",\r\n                \"type\": {\"enum\":[\"no\", \"yes\"]}\r\n            }\r\n        },\r\n        \"type\": \"object\"\r\n    },\r\n    \"type\": \"array\"\r\n}"
                                            },
                                            "value": "[{\"Name\":\"ProjectID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"Name\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"Data\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Status\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"LastModified\",\"Type\":\"Long\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"ErrorCode\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"ErrorMessage\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"}]"
                                        }
                                    ],
                                    "outputs": [],
                                    "inputs": [],
                                    "handler": {
                                        "settings": []
                                    },
                                    "reply": [],
                                    "s3Prefix": "flogo",
                                    "key": "flogo/GraphBuilder_Tools/connector/simpletable/connector.json",
                                    "display": {
                                        "description": "This is URL file reader",
                                        "category": "GraphBuilder_Tools",
                                        "visible": true,
                                        "smallIcon": "simpletable.png"
                                    },
                                    "actions": [
                                        {
                                            "name": "create",
                                            "display": {
                                                "name": "Create",
                                                "readonly": false,
                                                "valid": true,
                                                "visible": true
                                            }
                                        }
                                    ],
                                    "feature": {},
                                    "loopType": "none",
                                    "loopSettings": [],
                                    "retrySettings": [],
                                    "propertyMap": {},
                                    "keyfield": "name",
                                    "schemaMap": {},
                                    "iteratorAccumulate": false,
                                    "isValid": true,
                                    "lastUpdatedTime": 1636482504177,
                                    "user": "flogo",
                                    "connectorName": "AirTask",
                                    "connectorDescription": " "
                                },
                                "Method": "delete"
                            },
                            "input": {
                                "Mapping": {
                                    "mapping": {
                                        "ProjectID": "=$flow.ProjectID",
                                        "Name": "=$flow.Name"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "BuildFailed",
                        "name": "BuildFailed",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Success": "=$activity[BuildFlogo].Success",
                                    "Message": "=$activity[BuildFlogo].Message",
                                    "ErrorCode": "=$activity[BuildFlogo].ErrorCode"
                                }
                            }
                        }
                    }
                ],
                "errorHandler": {
                    "tasks": [
                        {
                            "id": "TableUpsert",
                            "name": "TableUpsert",
                            "description": "A simple activity for upserting data to table",
                            "activity": {
                                "ref": "#tableupsert",
                                "settings": {
                                    "Table": {
                                        "id": "9e35d4b0-6eeb-11eb-90dc-41e63340b2bf",
                                        "type": "flogo:connector",
                                        "version": "1.0.0",
                                        "name": "tibco-simple-table",
                                        "hashTags": [],
                                        "inputMappings": {},
                                        "outputMappings": {},
                                        "iteratorMappings": {},
                                        "title": "Simple Table",
                                        "description": "This is URL file reader",
                                        "ref": "github.com/TIBCOSoftware/GraphBuilder_Tools/connector/simpletable",
                                        "settings": [
                                            {
                                                "name": "name",
                                                "type": "string",
                                                "required": true,
                                                "display": {
                                                    "name": "Table Name",
                                                    "description": "Name of the table instance"
                                                },
                                                "value": "AirTask"
                                            },
                                            {
                                                "name": "description",
                                                "type": "string",
                                                "display": {
                                                    "name": "Description",
                                                    "description": "A simple table for storing tuple"
                                                },
                                                "value": ""
                                            },
                                            {
                                                "name": "schema",
                                                "type": "array",
                                                "required": true,
                                                "display": {
                                                    "name": "Table Schema",
                                                    "description": "Schema of the table",
                                                    "type": "table",
                                                    "schema": "{\r\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\r\n    \"definitions\": {},\r\n    \"id\": \"http://example.com/example.json\",\r\n    \"items\": {\r\n        \"id\": \"/items\",\r\n        \"properties\": {\r\n            \"Name\": {\r\n                \"id\": \"/items/properties/Name\",\r\n                \"type\": \"string\"\r\n            },\r\n            \"Type\": {\r\n                \"id\": \"/items/properties/Type\",\r\n                \"type\": {\"enum\":[\"String\", \"Integer\", \"Long\", \"Double\", \"Boolean\", \"Date\", \"Object\"]}\r\n            },\r\n            \"IsKey\": {\r\n                \"id\": \"/items/properties/IsKey\",\r\n                \"type\": {\"enum\":[\"no\", \"yes\"]}\r\n            },\r\n            \"Indexed\": {\r\n                \"id\": \"/items/properties/Indexed\",\r\n                \"type\": {\"enum\":[\"no\", \"yes\"]}\r\n            }\r\n        },\r\n        \"type\": \"object\"\r\n    },\r\n    \"type\": \"array\"\r\n}"
                                                },
                                                "value": "[{\"Name\":\"ProjectID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"Name\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"Data\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Status\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"LastModified\",\"Type\":\"Long\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"ErrorCode\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"ErrorMessage\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"}]"
                                            }
                                        ],
                                        "outputs": [],
                                        "inputs": [],
                                        "handler": {
                                            "settings": []
                                        },
                                        "reply": [],
                                        "s3Prefix": "flogo",
                                        "key": "flogo/GraphBuilder_Tools/connector/simpletable/connector.json",
                                        "display": {
                                            "description": "This is URL file reader",
                                            "category": "GraphBuilder_Tools",
                                            "visible": true,
                                            "smallIcon": "simpletable.png"
                                        },
                                        "actions": [
                                            {
                                                "name": "create",
                                                "display": {
                                                    "name": "Create",
                                                    "readonly": false,
                                                    "valid": true,
                                                    "visible": true
                                                }
                                            }
                                        ],
                                        "feature": {},
                                        "loopType": "none",
                                        "loopSettings": [],
                                        "retrySettings": [],
                                        "propertyMap": {},
                                        "keyfield": "name",
                                        "schemaMap": {},
                                        "iteratorAccumulate": false,
                                        "isValid": true,
                                        "lastUpdatedTime": 1636482504177,
                                        "user": "flogo",
                                        "connectorName": "AirTask",
                                        "connectorDescription": " "
                                    }
                                },
                                "input": {
                                    "Mapping": {
                                        "mapping": {
                                            "ProjectID": "=$flow.ProjectID",
                                            "Name": "=$flow.Name",
                                            "ErrorCode": "301",
                                            "Status": "ERROR"
                                        }
                                    }
                                }
                            }
                        },
                        {
                            "id": "Return3",
                            "name": "Return3",
                            "description": "Simple Return Activity",
                            "activity": {
                                "ref": "#actreturn",
                                "settings": {
                                    "mappings": {
                                        "Success": false,
                                        "ErrorCode": 400,
                                        "Message": "=string.concat(\"AirService::Build and Deploy Pipeline - \", $error.message)"
                                    }
                                }
                            }
                        }
                    ],
                    "links": [
                        {
                            "id": 9,
                            "from": "TableUpsert",
                            "to": "Return3",
                            "type": "default"
                        }
                    ]
                },
                "metadata": {
                    "input": [
                        {
                            "name": "ProjectID",
                            "type": "string"
                        },
                        {
                            "name": "Name",
                            "type": "string"
                        },
                        {
                            "name": "SyncBuild",
                            "type": "boolean"
                        },
                        {
                            "name": "ComponentType",
                            "type": "string"
                        },
                        {
                            "name": "ServiceType",
                            "type": "string"
                        },
                        {
                            "name": "Image",
                            "type": "string"
                        },
                        {
                            "name": "artifacts",
                            "type": "array",
                            "schema": {
                                "type": "json",
                                "value": "{\"type\":\"object\",\"properties\":{\"Type\":{\"type\":\"string\"},\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"},\"Encoded\":{\"type\":\"boolean\"}}}"
                            }
                        },
                        {
                            "name": "ModelDescriptor",
                            "type": "object",
                            "schema": {
                                "type": "json",
                                "value": "{\"Runner\":{\"type\":\"string\"},\"properties\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"}}}},\"ports\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"extra\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"}}}}}"
                            }
                        },
                        {
                            "name": "ScriptSystemEnv",
                            "type": "object",
                            "schema": {
                                "type": "json",
                                "value": "{\"TargetServer\":{\"type\":\"string\"},\"Username\":{\"type\":\"string\"}}"
                            }
                        }
                    ],
                    "output": [
                        {
                            "name": "Success",
                            "type": "boolean"
                        },
                        {
                            "name": "Message",
                            "type": "string"
                        },
                        {
                            "name": "ErrorCode",
                            "type": "float64"
                        }
                    ]
                },
                "explicitReply": true
            }
        },
        {
            "id": "flow:Ping",
            "data": {
                "name": "Ping",
                "description": "",
                "links": [
                    {
                        "id": 1,
                        "from": "BuildServiceInfo",
                        "to": "HTTPClient",
                        "type": "default"
                    }
                ],
                "tasks": [
                    {
                        "id": "BuildServiceInfo",
                        "name": "BuildServiceInfo",
                        "description": "JSON Serializer Activity",
                        "activity": {
                            "ref": "#jsonserializer",
                            "settings": {
                                "schemaFromfile": false,
                                "sample": {
                                    "filename": "ServiceLoaderRegist.json",
                                    "content": "data:application/json;base64,ewogICAgIklEIjogInByb2plY3RtZ3ItMTIzLjQ4Ni43ODkiLAogICAgIlR5cGUiOiAicHJvamVjdG1nciIsCiAgICAiVVJMIjogImh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vdXNlcnMvU3RldmVOWS1UaWJjby9yZXBvcyIKfQ=="
                                },
                                "dataSample": {
                                    "metadata": "{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"ID\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"},\"URL\":{\"type\":\"string\"},\"Properties\":{\"type\":\"object\",\"properties\":{}}}}",
                                    "value": "",
                                    "fe_metadata": "{\n    \"ID\": \"\",\n    \"Type\": \"\",\n    \"URL\": \"\",\n    \"Properties\": {}\n}"
                                }
                            },
                            "input": {
                                "Data": {
                                    "mapping": {
                                        "URL": "=\"http://\" + $property[\"System.ServiceLocatorIP\"] + \":10097/f1/modelservice\"",
                                        "Type": "air",
                                        "ID": "=\"modelservice_\" + $property[\"System.ServiceLocatorIP\"]"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "HTTPClient",
                        "name": "HTTPClient",
                        "description": "This activity build docker image from Dockerfile",
                        "activity": {
                            "ref": "#httpclient",
                            "settings": {
                                "method": "POST",
                                "timeout": "1000",
                                "urlMappingString": "",
                                "urlMapping": "",
                                "leftToken": "%",
                                "rightToken": "%",
                                "variablesDef": "[{\"Name\":\"ServiceLocatorIP\",\"Type\":\"String\"},{\"Name\":\"ServiceType\",\"Type\":\"String\"}]",
                                "httpHeaders": ""
                            },
                            "input": {
                                "URL": "http://%ServiceLocatorIP%:10080/f1/locator/register/%ServiceType%",
                                "Body": "=$activity[BuildServiceInfo].JSONString",
                                "SkipCondition": false,
                                "Variables": {
                                    "mapping": {
                                        "ServiceLocatorIP": "=$property[\"System.ServiceLocatorIP\"]",
                                        "ServiceType": "modelservice"
                                    }
                                }
                            },
                            "output": {
                                "Success": false
                            }
                        }
                    }
                ],
                "metadata": {
                    "input": [
                        {
                            "name": "Now",
                            "type": "string"
                        }
                    ],
                    "output": []
                }
            }
        },
        {
            "id": "flow:Undeploy_Model_Service",
            "data": {
                "name": "Undeploy Model Service",
                "description": "",
                "links": [
                    {
                        "id": 1,
                        "from": "LogDeployPipeline",
                        "to": "SetSystemProperties",
                        "type": "default"
                    },
                    {
                        "id": 2,
                        "from": "SetSystemProperties",
                        "to": "BuildRequest",
                        "type": "default"
                    },
                    {
                        "id": 3,
                        "from": "BuildRequest",
                        "to": "LogRequestToDeployer",
                        "type": "default"
                    },
                    {
                        "id": 4,
                        "from": "LogRequestToDeployer",
                        "to": "CallLightcraneUndeploy",
                        "type": "default"
                    },
                    {
                        "id": 5,
                        "from": "CallLightcraneUndeploy",
                        "to": "Return",
                        "type": "default"
                    }
                ],
                "tasks": [
                    {
                        "id": "LogDeployPipeline",
                        "name": "LogDeployPipeline",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:LogUndeployPipeline %%%%% ProjectID : \", $flow.ProjectID, \", Method : \", $flow.Method, coerce.toString($flow.SyncDeploy), \", ScriptSystemEnv : \", coerce.toString($flow.ScriptSystemEnv))"
                            }
                        }
                    },
                    {
                        "id": "SetSystemProperties",
                        "name": "SetSystemProperties",
                        "description": "Mapping field from input to output",
                        "activity": {
                            "ref": "#mapping",
                            "settings": {
                                "IsArray": false,
                                "MappingFields": "[{\"Name\":\"BaseFolder\",\"Type\":\"String\"},{\"Name\":\"ProjectFolderExt\",\"Type\":\"String\"},{\"Name\":\"ProjectFolderInt\",\"Type\":\"String\"},{\"Name\":\"Namespace\",\"Type\":\"String\"},{\"Name\":\"DeployerURL\",\"Type\":\"String\"},{\"Name\":\"SyncDeploy\",\"Type\":\"Boolean\"},{\"Name\":\"Location\",\"Type\":\"String\"}]"
                            },
                            "input": {
                                "Mapping": {
                                    "mapping": {
                                        "BaseFolder": "=$property[\"System.BaseFolder\"]",
                                        "ProjectFolderExt": "=$property[\"System.BaseFolderExt\"] + \"/projects/\"",
                                        "ProjectFolderInt": "=\"/home/f1/projects/\" + $flow.ProjectID",
                                        "Namespace": "=f1.escapek8sid($flow.ProjectID)",
                                        "DeployerURL": "=$property[\"System.DeployerURL\"]",
                                        "SkipCondition": false,
                                        "SyncDeploy": "=f1.ternary(null!=$flow.SyncDeploy, $flow.SyncDeploy, false)",
                                        "Location": "=f1.ternary(\"\"==coerce.toString(f1.getsubobject($flow.ScriptSystemEnv, \"TargetServer\")), \"localhost\", coerce.toString(f1.getsubobject($flow.ScriptSystemEnv, \"TargetServer\")))"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "BuildRequest",
                        "name": "BuildRequest",
                        "description": "JSON Serializer Activity",
                        "activity": {
                            "ref": "#jsonserializer",
                            "settings": {
                                "schemaFromfile": false,
                                "sample": "",
                                "dataSample": {
                                    "metadata": "{\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n    \"type\": \"object\",\n    \"properties\": {\n        \"SyncDeploy\": {\n            \"type\": \"boolean\"\n        },\n        \"NoF1Descriptor\": {\n            \"type\": \"boolean\"\n        },\n        \"Method\": {\n            \"type\": \"string\"\n        },\n        \"ProjectID\": {\n            \"type\": \"string\"\n        },\n        \"ScriptSystemEnv\": {\n            \"type\": \"object\",\n            \"properties\": {}\n        },\n        \"UserDefinedParameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"ServiceName\": {\n                    \"type\": \"string\"\n                },\n                \"Descriptor\": {\n                    \"type\": \"string\"\n                }\n            }\n        }\n    }\n}",
                                    "value": "",
                                    "fe_metadata": "{\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n    \"type\": \"object\",\n    \"properties\": {\n        \"SyncDeploy\": {\n            \"type\": \"boolean\"\n        },\n        \"NoF1Descriptor\": {\n            \"type\": \"boolean\"\n        },\n        \"Method\": {\n            \"type\": \"string\"\n        },\n        \"ProjectID\": {\n            \"type\": \"string\"\n        },\n        \"ScriptSystemEnv\": {\n            \"type\": \"object\",\n            \"properties\": {}\n        },\n        \"UserDefinedParameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"ServiceName\": {\n                    \"type\": \"string\"\n                },\n                \"Descriptor\": {\n                    \"type\": \"string\"\n                }\n            }\n        }\n    }\n}"
                                }
                            },
                            "input": {
                                "Data": {
                                    "mapping": {
                                        "ScriptSystemEnv": "=$flow.ScriptSystemEnv",
                                        "SyncDeploy": "=$activity[SetSystemProperties].Data.SyncDeploy",
                                        "NoF1Descriptor": false,
                                        "Method": "=$flow.Method",
                                        "ProjectID": "=$flow.ProjectID"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "LogRequestToDeployer",
                        "name": "LogRequestToDeployer",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:LogDeployPipeline %%%%% Request To deployF1Descriptor : \", $activity[BuildRequest].JSONString)"
                            }
                        }
                    },
                    {
                        "id": "CallLightcraneUndeploy",
                        "name": "CallLightcraneUndeploy",
                        "description": "Simple SubFlow Activity",
                        "activity": {
                            "ref": "#subflow",
                            "settings": {
                                "flowURI": "res://flow:Call_Lightcrane_Service"
                            },
                            "input": {
                                "ServiceURL": "=$activity[SetSystemProperties].Data.DeployerURL+\"/f1/deployer/undeploy/\"+$flow.ProjectID+\"/\"+$flow.Name+\"/\"+$flow.Instance",
                                "RequestBody": "=$activity[BuildRequest].JSONString",
                                "ProjectID": "=$flow.ProjectID",
                                "Name": "=$flow.Name",
                                "Properties": {
                                    "mapping": {
                                        "Status": "Undeploying"
                                    }
                                },
                                "Location": "=$activity[SetSystemProperties].Data.Location"
                            }
                        }
                    },
                    {
                        "id": "Return",
                        "name": "Return",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Success": "=$activity[CallLightcraneUndeploy].Success",
                                    "Message": "=$activity[CallLightcraneUndeploy].Message",
                                    "ErrorCode": "=$activity[CallLightcraneUndeploy].ErrorCode"
                                }
                            }
                        }
                    }
                ],
                "errorHandler": {
                    "tasks": [
                        {
                            "id": "Return1",
                            "name": "Return1",
                            "description": "Simple Return Activity",
                            "activity": {
                                "ref": "#actreturn",
                                "settings": {
                                    "mappings": {
                                        "Message": "=string.concat(\"AirService::Undeploy Pipeline - \", $error.message)",
                                        "Success": false,
                                        "ErrorCode": 400
                                    }
                                }
                            }
                        }
                    ],
                    "links": []
                },
                "metadata": {
                    "input": [
                        {
                            "name": "ProjectID",
                            "type": "string"
                        },
                        {
                            "name": "Name",
                            "type": "string"
                        },
                        {
                            "name": "Instance",
                            "type": "string"
                        },
                        {
                            "name": "Method",
                            "type": "string"
                        },
                        {
                            "name": "SyncDeploy",
                            "type": "boolean"
                        },
                        {
                            "name": "ScriptSystemEnv",
                            "type": "object"
                        }
                    ],
                    "output": [
                        {
                            "name": "Success",
                            "type": "boolean"
                        },
                        {
                            "name": "Message",
                            "type": "string"
                        },
                        {
                            "name": "ErrorCode",
                            "type": "float64"
                        }
                    ]
                },
                "explicitReply": true
            }
        },
        {
            "id": "flow:Deploy_Model_Service",
            "data": {
                "name": "Deploy Model Service",
                "description": "",
                "links": [
                    {
                        "id": 1,
                        "from": "LogDeployPipeline",
                        "to": "ChkUserScriptExistence",
                        "type": "default"
                    },
                    {
                        "id": 2,
                        "from": "ChkUserScriptExistence",
                        "to": "SetSystemProperties",
                        "type": "default"
                    },
                    {
                        "id": 3,
                        "from": "SetSystemProperties",
                        "to": "ReadPropertyNameDef",
                        "type": "default"
                    },
                    {
                        "id": 4,
                        "from": "ReadPropertyNameDef",
                        "to": "ReadF1Descriptor",
                        "type": "default"
                    },
                    {
                        "id": 5,
                        "from": "ReadF1Descriptor",
                        "to": "LogDescriptors",
                        "type": "default"
                    },
                    {
                        "id": 6,
                        "from": "LogDescriptors",
                        "to": "ResolveParameters",
                        "type": "default"
                    },
                    {
                        "id": 7,
                        "from": "ResolveParameters",
                        "to": "ExtractDescriptor",
                        "type": "default"
                    },
                    {
                        "id": 8,
                        "from": "ExtractDescriptor",
                        "to": "ModifyService",
                        "type": "default"
                    },
                    {
                        "id": 9,
                        "from": "ModifyService",
                        "to": "BuildRequest",
                        "type": "default"
                    },
                    {
                        "id": 10,
                        "from": "BuildRequest",
                        "to": "LogRequestToDeployer",
                        "type": "default"
                    },
                    {
                        "id": 11,
                        "from": "LogRequestToDeployer",
                        "to": "CallLightcraneDeploy",
                        "type": "default"
                    },
                    {
                        "id": 12,
                        "from": "CallLightcraneDeploy",
                        "to": "Return",
                        "type": "default"
                    }
                ],
                "tasks": [
                    {
                        "id": "LogDeployPipeline",
                        "name": "LogDeployPipeline",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:LogDeployPipeline %%%%% ProjectID : \", $flow.ProjectID, \", Method : \", $flow.Method, coerce.toString($flow.SyncDeploy), \", ScriptSystemEnv : \", coerce.toString($flow.ScriptSystemEnv), \", ModelDescriptor : \", coerce.toString($flow.ModelDescriptor))"
                            }
                        }
                    },
                    {
                        "id": "ChkUserScriptExistence",
                        "name": "ChkUserScriptExistence",
                        "description": "This activity write incoming object to file system",
                        "activity": {
                            "ref": "#filereader",
                            "settings": {
                                "BaseFolder": ""
                            },
                            "input": {
                                "FilePattern": "=\"/home/f1/projects/\" + $flow.ProjectID + \"/deploy/deploy.sh\""
                            }
                        }
                    },
                    {
                        "id": "SetSystemProperties",
                        "name": "SetSystemProperties",
                        "description": "Mapping field from input to output",
                        "activity": {
                            "ref": "#mapping",
                            "settings": {
                                "IsArray": false,
                                "MappingFields": "[{\"Name\":\"BaseFolder\",\"Type\":\"String\"},{\"Name\":\"ProjectFolderExt\",\"Type\":\"String\"},{\"Name\":\"ProjectFolderInt\",\"Type\":\"String\"},{\"Name\":\"DeployFolderInt\",\"Type\":\"String\"},{\"Name\":\"Namespace\",\"Type\":\"String\"},{\"Name\":\"UseDefaultScript\",\"Type\":\"Boolean\"},{\"Name\":\"DeployerURL\",\"Type\":\"String\"},{\"Name\":\"SyncDeploy\",\"Type\":\"Boolean\"},{\"Name\":\"RuntimeProperties\",\"Type\":\"Array\"},{\"Name\":\"ExtraProperties\",\"Type\":\"Array\"},{\"Name\":\"Location\",\"Type\":\"String\"}]"
                            },
                            "input": {
                                "Mapping": {
                                    "mapping": {
                                        "BaseFolder": "=$property[\"System.BaseFolder\"]",
                                        "ProjectFolderExt": "=$property[\"System.BaseFolderExt\"] + \"/projects/\"",
                                        "ProjectFolderInt": "=\"/home/f1/projects/\" + $flow.ProjectID",
                                        "DeployFolderInt": "=f1.ternary(null!=$activity[ChkUserScriptExistence].Results&&0!=array.count($activity[ChkUserScriptExistence].Results),\"/home/f1/projects/\" + $flow.ProjectID + \"/deploy/\", \"/home/scripts\")",
                                        "Namespace": "=f1.escapek8sid($flow.ProjectID)",
                                        "UseDefaultScript": "=f1.ternary(null!=$activity[ChkUserScriptExistence].Results&&0!=array.count($activity[ChkUserScriptExistence].Results), false, true)",
                                        "DeployerURL": "=$property[\"System.DeployerURL\"]",
                                        "SkipCondition": false,
                                        "SyncDeploy": "=f1.ternary(null!=$flow.SyncDeploy, $flow.SyncDeploy, false)",
                                        "ExtraProperties": "=coerce.toArray(f1.ternary(null!=$flow.ModelDescriptor, $flow.ModelDescriptor.extra, null))",
                                        "RuntimeProperties": "=coerce.toArray(f1.ternary(null!=$flow.ModelDescriptor.dynamic, $flow.ModelDescriptor.dynamic.properties, null))",
                                        "Location": "=f1.ternary(\"\"==coerce.toString(f1.getsubobject($flow.ScriptSystemEnv, \"TargetServer\")), \"localhost\", coerce.toString(f1.getsubobject($flow.ScriptSystemEnv, \"TargetServer\")))"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "ReadPropertyNameDef",
                        "name": "ReadPropertyNameDef",
                        "description": "This activity write incoming object to file system",
                        "activity": {
                            "ref": "#filereader",
                            "settings": {
                                "BaseFolder": "/home/f1/projects"
                            },
                            "input": {
                                "FilePattern": "=$flow.ProjectID + \"/pipeline/\" + $flow.Name + \"_property_name_def.json\""
                            }
                        }
                    },
                    {
                        "id": "ReadF1Descriptor",
                        "name": "ReadF1Descriptor",
                        "description": "This activity write incoming object to file system",
                        "activity": {
                            "ref": "#filereader",
                            "settings": {
                                "BaseFolder": "/home/f1/projects"
                            },
                            "input": {
                                "FilePattern": "=$flow.ProjectID + \"/pipeline/\" + $flow.Name + \".json\""
                            }
                        }
                    },
                    {
                        "id": "LogDescriptors",
                        "name": "LogDescriptors",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:LogDescriptors %%%%% PropertyNameDef : /home/f1/projects/\", $flow.ProjectID + \"/pipeline/\" + $flow.Name + \"_property_name_def.json = \", coerce.toString($activity[ReadPropertyNameDef].Results), \", F1Descriptor : /home/f1/projects/\", $flow.ProjectID + \"/pipeline/\" + $flow.Name + \".json = \", coerce.toString($activity[ReadF1Descriptor].Results))"
                            }
                        }
                    },
                    {
                        "id": "ResolveParameters",
                        "name": "ResolveParameters",
                        "description": "Replace target text from input text",
                        "activity": {
                            "ref": "#textreplacer",
                            "settings": {
                                "leftToken": "$",
                                "rightToken": "$",
                                "replacementKeys": "[{\"Name\":\"temp.project.home\",\"Type\":\"String\"},{\"Name\":\"ID\",\"Type\":\"String\"},{\"Name\":\"ServiceLocator\",\"Type\":\"String\"},{\"Name\":\"ExternalEndpointIP\",\"Type\":\"String\"},{\"Name\":\"ExternalEndpointPort\",\"Type\":\"String\"}]"
                            },
                            "input": {
                                "inputDocument": "=$activity[ReadF1Descriptor].Results[0].Content",
                                "replacements": {
                                    "mapping": {
                                        "temp.project.home": "=$activity[SetSystemProperties].Data.ProjectFolderExt + $flow.ProjectID",
                                        "ID": "=$flow.ProjectID",
                                        "ServiceLocator": "=$property[\"System.ServiceLocatorExternal\"]",
                                        "ExternalEndpointIP": "=$property[\"System.ExternalEndpointIP\"]",
                                        "ExternalEndpointPort": "10100"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "ExtractDescriptor",
                        "name": "ExtractDescriptor",
                        "description": "JSON Deserializer Activity",
                        "activity": {
                            "ref": "#jsondeserializer",
                            "settings": {
                                "schemaFromfile": false,
                                "sample": "",
                                "dataSample": {
                                    "metadata": "{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"DeploymentGpID\":{\"type\":\"string\"},\"Services\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Descriptor\":{\"type\":\"string\"},\"Name\":{\"type\":\"string\"},\"Properties\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Group\":{\"type\":\"string\"},\"Value\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"}}}}}},\"ScriptSystemEnv\":{\"type\":\"object\",\"properties\":{}},\"Type\":{\"type\":\"string\"},\"Variables\":{\"type\":\"object\",\"properties\":{}}}}}}}",
                                    "value": "",
                                    "fe_metadata": "{\n\t\"DeploymentGpID\":\"\",\n\t\"Services\":[\n\t\t{\n\t\t\t\"Descriptor\":\"\",\n\t\t\t\"Name\":\"\",\n\t\t\t\"Properties\":[{\n\t\t\t    \"Group\": \"\",\n\t\t\t    \"Value\": {\"Name\":\"\",\"Value\":\"\"}\n\t\t\t}],\n\t\t\t\"ScriptSystemEnv\":{},\n\t\t\t\"Type\":\"\",\n\t\t\t\"Variables\":{\n\t\t\t}\n\t\t}\n\t]\n}"
                                }
                            },
                            "input": {
                                "JSONString": "=$activity[ResolveParameters].outputDocument"
                            }
                        }
                    },
                    {
                        "id": "ModifyService",
                        "name": "ModifyService",
                        "description": "Make an New Object",
                        "activity": {
                            "ref": "#objectmaker",
                            "settings": {
                                "schemaFromfile": false,
                                "sample": "",
                                "dataSample": {
                                    "metadata": "{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"Service\":{\"type\":\"object\",\"properties\":{\"Descriptor\":{\"type\":\"string\"},\"Name\":{\"type\":\"string\"},\"Instance\":{\"type\":\"string\"},\"Properties\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Group\":{\"type\":\"string\"},\"Value\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"}}}}}},\"ScriptSystemEnv\":{\"type\":\"object\",\"properties\":{}},\"Type\":{\"type\":\"string\"},\"Variables\":{\"type\":\"object\",\"properties\":{}}}}}}",
                                    "value": "",
                                    "fe_metadata": "{\n    \"Service\":{\n\t\t\t\"Descriptor\":\"\",\n\t\t\t\"Name\":\"\",\n\t\t\t\"Instance\":\"\",\n\t\t\t\"Properties\":[{\n\t\t\t    \"Group\": \"\",\n\t\t\t    \"Value\": {\"Name\":\"\",\"Value\":\"\"}\n\t\t\t}],\n\t\t\t\"ScriptSystemEnv\":{},\n\t\t\t\"Type\":\"\",\n\t\t\t\"Variables\":{\n\t\t\t}\n\t\t}\n}"
                                }
                            },
                            "input": {
                                "ObjectDataMapping": {
                                    "mapping": {
                                        "Service": {
                                            "Descriptor": "=$activity[ExtractDescriptor].Data.Services[0].Descriptor",
                                            "Name": "=$activity[ExtractDescriptor].Data.Services[0].Name",
                                            "ScriptSystemEnv": "=$activity[ExtractDescriptor].Data.Services[0].ScriptSystemEnv",
                                            "Type": "=$activity[ExtractDescriptor].Data.Services[0].Type",
                                            "Variables": "=$activity[ExtractDescriptor].Data.Services[0].Variables",
                                            "Instance": "=$flow.Instance",
                                            "Properties": "=f1.air2f1properties(\n\t$activity[ExtractDescriptor].Data.Services[0].Type, \n\tf1.ternary(\n\t\t\"k8s\"==$activity[ExtractDescriptor].Data.Services[0].Type, \n\t\t\"spec.template.spec.containers[0].env\", \n\t\t\"services.\"+$activity[ExtractDescriptor].Data.Services[0].Name+\".environment\"\n\t), \n\t$activity[ExtractDescriptor].Data.Services[0].Properties, \n\tf1.toobjectarray($activity[SetSystemProperties].Data.RuntimeProperties), \n\tf1.json2object($activity[ReadPropertyNameDef].Results[0].Content),\n\tf1.toobjectarray($activity[SetSystemProperties].Data.ExtraProperties)\n)"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "BuildRequest",
                        "name": "BuildRequest",
                        "description": "JSON Serializer Activity",
                        "activity": {
                            "ref": "#jsonserializer",
                            "settings": {
                                "schemaFromfile": false,
                                "sample": "",
                                "dataSample": {
                                    "metadata": "{\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n    \"type\": \"object\",\n    \"properties\": {\n        \"SyncDeploy\": {\n            \"type\": \"boolean\"\n        },\n        \"ProjectFolderInt\": {\n            \"type\": \"string\"\n        },\n        \"DeployFolder\": {\n            \"type\": \"string\"\n        },\n        \"UseDefaultScript\": {\n            \"type\": \"boolean\"\n        },\n        \"ScriptSystemEnv\": {\n            \"type\": \"object\",\n            \"properties\": {}\n        },\n        \"F1Descriptor\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"DeploymentGpID\": {\n                    \"type\": \"string\"\n                },\n                \"DataFlow\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"Upstream\": {\n                                \"type\": \"string\"\n                            },\n                            \"Downstream\": {\n                                \"type\": \"string\"\n                            }\n                        }\n                    }\n                },\n                \"Components\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"Type\": {\n                                \"type\": \"string\"\n                            },\n                            \"Runtime\": {\n                                \"type\": \"string\"\n                            },\n                            \"Name\": {\n                                \"type\": \"string\"\n                            },\n                            \"Replicas\": {\n                                \"type\": \"number\"\n                            },\n                            \"DockerImage\": {\n                                \"type\": \"string\"\n                            },\n                            \"Volumes\": {\n                                \"type\": \"array\",\n                                \"items\": {\n                                    \"type\": \"object\",\n                                    \"properties\": {\n                                        \"Name\": {\n                                            \"type\": \"string\"\n                                        },\n                                        \"MountPoint\": {\n                                            \"type\": \"string\"\n                                        }\n                                    }\n                                }\n                            },\n                            \"Properties\": {\n                                \"type\": \"array\",\n                                \"items\": {\n                                    \"type\": \"object\",\n                                    \"properties\": {\n                                        \"Name\": {\n                                            \"type\": \"string\"\n                                        },\n                                        \"Value\": {\n                                            \"type\": \"string\"\n                                        },\n                                        \"Type\": {\n                                            \"type\": \"string\"\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                },\n                \"Services\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"Type\": {\n                                \"type\": \"string\"\n                            },\n                            \"Name\": {\n                                \"type\": \"string\"\n                            },\n                            \"Instance\": {\n                                \"type\": \"string\"\n                            },\n                            \"Descriptor\": {\n                                \"type\": \"string\"\n                            },\n                            \"Variables\": {\n                                \"type\": \"object\",\n                                \"properties\": {}\n                            },\n                            \"Properties\": {\n                                \"type\": \"array\",\n                                \"items\": {\n                                    \"type\": \"object\",\n                                    \"properties\": {\n                                        \"Group\": {\n                                            \"type\": \"string\"\n                                        },\n                                        \"Value\": {\n                                            \"type\": \"array\",\n                                            \"items\": {\n                                                \"type\": \"object\",\n                                                \"properties\": {\n                                                    \"Name\": {\n                                                        \"type\": \"string\"\n                                                    },\n                                                    \"Value\": {\n                                                        \"type\": \"string\"\n                                                    },\n                                                    \"Type\": {\n                                                        \"type\": \"string\"\n                                                    }\n                                                }\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                },\n                \"System\": {\n                    \"type\": \"object\",\n                    \"properties\": {}\n                }\n            }\n        }\n    }\n}",
                                    "value": "",
                                    "fe_metadata": "{\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n    \"type\": \"object\",\n    \"properties\": {\n        \"SyncDeploy\": {\n            \"type\": \"boolean\"\n        },\n        \"ProjectFolderInt\": {\n            \"type\": \"string\"\n        },\n        \"DeployFolder\": {\n            \"type\": \"string\"\n        },\n        \"UseDefaultScript\": {\n            \"type\": \"boolean\"\n        },\n        \"ScriptSystemEnv\": {\n            \"type\": \"object\",\n            \"properties\": {}\n        },\n        \"F1Descriptor\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"DeploymentGpID\": {\n                    \"type\": \"string\"\n                },\n                \"DataFlow\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"Upstream\": {\n                                \"type\": \"string\"\n                            },\n                            \"Downstream\": {\n                                \"type\": \"string\"\n                            }\n                        }\n                    }\n                },\n                \"Components\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"Type\": {\n                                \"type\": \"string\"\n                            },\n                            \"Runtime\": {\n                                \"type\": \"string\"\n                            },\n                            \"Name\": {\n                                \"type\": \"string\"\n                            },\n                            \"Replicas\": {\n                                \"type\": \"number\"\n                            },\n                            \"DockerImage\": {\n                                \"type\": \"string\"\n                            },\n                            \"Volumes\": {\n                                \"type\": \"array\",\n                                \"items\": {\n                                    \"type\": \"object\",\n                                    \"properties\": {\n                                        \"Name\": {\n                                            \"type\": \"string\"\n                                        },\n                                        \"MountPoint\": {\n                                            \"type\": \"string\"\n                                        }\n                                    }\n                                }\n                            },\n                            \"Properties\": {\n                                \"type\": \"array\",\n                                \"items\": {\n                                    \"type\": \"object\",\n                                    \"properties\": {\n                                        \"Name\": {\n                                            \"type\": \"string\"\n                                        },\n                                        \"Value\": {\n                                            \"type\": \"string\"\n                                        },\n                                        \"Type\": {\n                                            \"type\": \"string\"\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                },\n                \"Services\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"Type\": {\n                                \"type\": \"string\"\n                            },\n                            \"Name\": {\n                                \"type\": \"string\"\n                            },\n                            \"Instance\": {\n                                \"type\": \"string\"\n                            },\n                            \"Descriptor\": {\n                                \"type\": \"string\"\n                            },\n                            \"Variables\": {\n                                \"type\": \"object\",\n                                \"properties\": {}\n                            },\n                            \"Properties\": {\n                                \"type\": \"array\",\n                                \"items\": {\n                                    \"type\": \"object\",\n                                    \"properties\": {\n                                        \"Group\": {\n                                            \"type\": \"string\"\n                                        },\n                                        \"Value\": {\n                                            \"type\": \"array\",\n                                            \"items\": {\n                                                \"type\": \"object\",\n                                                \"properties\": {\n                                                    \"Name\": {\n                                                        \"type\": \"string\"\n                                                    },\n                                                    \"Value\": {\n                                                        \"type\": \"string\"\n                                                    },\n                                                    \"Type\": {\n                                                        \"type\": \"string\"\n                                                    }\n                                                }\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                },\n                \"System\": {\n                    \"type\": \"object\",\n                    \"properties\": {}\n                }\n            }\n        }\n    }\n}"
                                }
                            },
                            "input": {
                                "Data": {
                                    "mapping": {
                                        "UseDefaultScript": "=$activity[SetSystemProperties].Data.UseDefaultScript",
                                        "ProjectFolderInt": "=$activity[SetSystemProperties].Data.ProjectFolderInt",
                                        "ScriptSystemEnv": "=$flow.ScriptSystemEnv",
                                        "DeployFolder": "=$activity[SetSystemProperties].Data.DeployFolderInt",
                                        "F1Descriptor": {
                                            "DeploymentGpID": "=$activity[ExtractDescriptor].Data.DeploymentGpID",
                                            "Services": "=array.create($activity[ModifyService].ObjectOut.Service)"
                                        },
                                        "SyncDeploy": "=$activity[SetSystemProperties].Data.SyncDeploy"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "LogRequestToDeployer",
                        "name": "LogRequestToDeployer",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:LogDeployPipeline %%%%% Request To deployF1Descriptor : \", $activity[BuildRequest].JSONString)"
                            }
                        }
                    },
                    {
                        "id": "CallLightcraneDeploy",
                        "name": "CallLightcraneDeploy",
                        "description": "Simple SubFlow Activity",
                        "activity": {
                            "ref": "#subflow",
                            "settings": {
                                "flowURI": "res://flow:Call_Lightcrane_Service"
                            },
                            "input": {
                                "ServiceURL": "=$activity[SetSystemProperties].Data.DeployerURL+\"/f1/deployer/deployF1Descriptor/\"+$flow.ProjectID",
                                "RequestBody": "=$activity[BuildRequest].JSONString",
                                "ProjectID": "=$flow.ProjectID",
                                "Name": "=$flow.Name",
                                "Properties": {
                                    "mapping": {
                                        "Status": "Deploying"
                                    }
                                },
                                "Location": "=$activity[SetSystemProperties].Data.Location"
                            }
                        }
                    },
                    {
                        "id": "Return",
                        "name": "Return",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Message": "=$activity[CallLightcraneDeploy].Message",
                                    "ErrorCode": "=$activity[CallLightcraneDeploy].ErrorCode",
                                    "Success": "=$activity[CallLightcraneDeploy].Success"
                                }
                            }
                        }
                    }
                ],
                "errorHandler": {
                    "tasks": [
                        {
                            "id": "TableMutate1",
                            "name": "TableMutate1",
                            "description": "A simple activity for upserting/deleting data to/from table",
                            "activity": {
                                "ref": "#tablemutate",
                                "settings": {
                                    "Table": {
                                        "id": "9e35d4b0-6eeb-11eb-90dc-41e63340b2bf",
                                        "type": "flogo:connector",
                                        "version": "1.0.0",
                                        "name": "tibco-simple-table",
                                        "hashTags": [],
                                        "inputMappings": {},
                                        "outputMappings": {},
                                        "iteratorMappings": {},
                                        "title": "Simple Table",
                                        "description": "This is URL file reader",
                                        "ref": "github.com/TIBCOSoftware/GraphBuilder_Tools/connector/simpletable",
                                        "settings": [
                                            {
                                                "name": "name",
                                                "type": "string",
                                                "required": true,
                                                "display": {
                                                    "name": "Table Name",
                                                    "description": "Name of the table instance"
                                                },
                                                "value": "AirTask"
                                            },
                                            {
                                                "name": "description",
                                                "type": "string",
                                                "display": {
                                                    "name": "Description",
                                                    "description": "A simple table for storing tuple"
                                                },
                                                "value": ""
                                            },
                                            {
                                                "name": "schema",
                                                "type": "array",
                                                "required": true,
                                                "display": {
                                                    "name": "Table Schema",
                                                    "description": "Schema of the table",
                                                    "type": "table",
                                                    "schema": "{\r\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\r\n    \"definitions\": {},\r\n    \"id\": \"http://example.com/example.json\",\r\n    \"items\": {\r\n        \"id\": \"/items\",\r\n        \"properties\": {\r\n            \"Name\": {\r\n                \"id\": \"/items/properties/Name\",\r\n                \"type\": \"string\"\r\n            },\r\n            \"Type\": {\r\n                \"id\": \"/items/properties/Type\",\r\n                \"type\": {\"enum\":[\"String\", \"Integer\", \"Long\", \"Double\", \"Boolean\", \"Date\", \"Object\"]}\r\n            },\r\n            \"IsKey\": {\r\n                \"id\": \"/items/properties/IsKey\",\r\n                \"type\": {\"enum\":[\"no\", \"yes\"]}\r\n            },\r\n            \"Indexed\": {\r\n                \"id\": \"/items/properties/Indexed\",\r\n                \"type\": {\"enum\":[\"no\", \"yes\"]}\r\n            }\r\n        },\r\n        \"type\": \"object\"\r\n    },\r\n    \"type\": \"array\"\r\n}"
                                                },
                                                "value": "[{\"Name\":\"ProjectID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"Name\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"Data\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Status\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"LastModified\",\"Type\":\"Long\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"ErrorCode\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"ErrorMessage\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"}]"
                                            }
                                        ],
                                        "outputs": [],
                                        "inputs": [],
                                        "handler": {
                                            "settings": []
                                        },
                                        "reply": [],
                                        "s3Prefix": "flogo",
                                        "key": "flogo/GraphBuilder_Tools/connector/simpletable/connector.json",
                                        "display": {
                                            "description": "This is URL file reader",
                                            "category": "GraphBuilder_Tools",
                                            "visible": true,
                                            "smallIcon": "simpletable.png"
                                        },
                                        "actions": [
                                            {
                                                "name": "create",
                                                "display": {
                                                    "name": "Create",
                                                    "readonly": false,
                                                    "valid": true,
                                                    "visible": true
                                                }
                                            }
                                        ],
                                        "feature": {},
                                        "loopType": "none",
                                        "loopSettings": [],
                                        "retrySettings": [],
                                        "propertyMap": {},
                                        "keyfield": "name",
                                        "schemaMap": {},
                                        "iteratorAccumulate": false,
                                        "isValid": true,
                                        "lastUpdatedTime": 1636482504177,
                                        "user": "flogo",
                                        "connectorName": "AirTask",
                                        "connectorDescription": " "
                                    },
                                    "Method": "upsert"
                                },
                                "input": {
                                    "Mapping": {
                                        "mapping": {
                                            "ProjectID": "=$flow.ProjectID",
                                            "Name": "=$flow.Name",
                                            "Status": "Error"
                                        }
                                    }
                                }
                            }
                        },
                        {
                            "id": "Return1",
                            "name": "Return1",
                            "description": "Simple Return Activity",
                            "activity": {
                                "ref": "#actreturn",
                                "settings": {
                                    "mappings": {
                                        "Success": false,
                                        "Message": "=string.concat(\"AirService::Deploy Pipeline - \", $error.message)",
                                        "ErrorCode": 400
                                    }
                                }
                            }
                        }
                    ],
                    "links": [
                        {
                            "id": 12,
                            "from": "TableMutate1",
                            "to": "Return1",
                            "type": "default"
                        }
                    ]
                },
                "metadata": {
                    "input": [
                        {
                            "name": "ProjectID",
                            "type": "string"
                        },
                        {
                            "name": "Name",
                            "type": "string"
                        },
                        {
                            "name": "Instance",
                            "type": "string"
                        },
                        {
                            "name": "Method",
                            "type": "string"
                        },
                        {
                            "name": "SyncDeploy",
                            "type": "boolean"
                        },
                        {
                            "name": "ScriptSystemEnv",
                            "type": "object"
                        },
                        {
                            "name": "ModelDescriptor",
                            "type": "object",
                            "schema": {
                                "type": "json",
                                "value": "{\"dynamic\":{\"type\":\"object\",\"properties\":{\"properties\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Component\":{\"type\":\"string\"},\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"}}}}}},\"extra\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}}}}}"
                            }
                        }
                    ],
                    "output": [
                        {
                            "name": "Success",
                            "type": "boolean"
                        },
                        {
                            "name": "Message",
                            "type": "string"
                        },
                        {
                            "name": "ErrorCode",
                            "type": "float64"
                        }
                    ]
                },
                "explicitReply": true
            }
        },
        {
            "id": "flow:RSVP_from_builder",
            "data": {
                "name": "RSVP from builder",
                "description": "**** Builder callback to report build result ****",
                "links": [
                    {
                        "id": 1,
                        "from": "LogMessage",
                        "to": "TableMutate",
                        "type": "default"
                    },
                    {
                        "id": 2,
                        "from": "TableMutate",
                        "to": "LogTaskExistsAndSuccessful",
                        "type": "expression",
                        "label": "TableMutatetoDeployPipeline",
                        "value": "$activity[TableMutate].Exists&&$flow.Successful"
                    },
                    {
                        "id": 3,
                        "from": "LogTaskExistsAndSuccessful",
                        "to": "DeployPipeline",
                        "type": "default"
                    },
                    {
                        "id": 4,
                        "from": "DeployPipeline",
                        "to": "Return4",
                        "type": "default"
                    },
                    {
                        "id": 5,
                        "from": "TableMutate",
                        "to": "LogTaskNotFoundOrFail",
                        "type": "exprOtherwise",
                        "label": "TableMutatetoReturn5"
                    },
                    {
                        "id": 6,
                        "from": "LogTaskNotFoundOrFail",
                        "to": "Return5",
                        "type": "default"
                    }
                ],
                "tasks": [
                    {
                        "id": "LogMessage",
                        "name": "LogMessage",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:BuildNdDeployAirPipeline RSVP Event %%%%% ProjectID : \", $flow.ProjectID, \", Name : \", $flow.Name, \", Successful: \", $flow.Successful, \", ErrorMsg : \", $flow.ErrorMsg)"
                            }
                        }
                    },
                    {
                        "id": "TableMutate",
                        "name": "TableMutate",
                        "description": "A simple activity for upserting/deleting data to/from table",
                        "activity": {
                            "ref": "#tablemutate",
                            "settings": {
                                "Table": {
                                    "id": "9e35d4b0-6eeb-11eb-90dc-41e63340b2bf",
                                    "type": "flogo:connector",
                                    "version": "1.0.0",
                                    "name": "tibco-simple-table",
                                    "hashTags": [],
                                    "inputMappings": {},
                                    "outputMappings": {},
                                    "iteratorMappings": {},
                                    "title": "Simple Table",
                                    "description": "This is URL file reader",
                                    "ref": "github.com/TIBCOSoftware/GraphBuilder_Tools/connector/simpletable",
                                    "settings": [
                                        {
                                            "name": "name",
                                            "type": "string",
                                            "required": true,
                                            "display": {
                                                "name": "Table Name",
                                                "description": "Name of the table instance"
                                            },
                                            "value": "AirTask"
                                        },
                                        {
                                            "name": "description",
                                            "type": "string",
                                            "display": {
                                                "name": "Description",
                                                "description": "A simple table for storing tuple"
                                            },
                                            "value": ""
                                        },
                                        {
                                            "name": "schema",
                                            "type": "array",
                                            "required": true,
                                            "display": {
                                                "name": "Table Schema",
                                                "description": "Schema of the table",
                                                "type": "table",
                                                "schema": "{\r\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\r\n    \"definitions\": {},\r\n    \"id\": \"http://example.com/example.json\",\r\n    \"items\": {\r\n        \"id\": \"/items\",\r\n        \"properties\": {\r\n            \"Name\": {\r\n                \"id\": \"/items/properties/Name\",\r\n                \"type\": \"string\"\r\n            },\r\n            \"Type\": {\r\n                \"id\": \"/items/properties/Type\",\r\n                \"type\": {\"enum\":[\"String\", \"Integer\", \"Long\", \"Double\", \"Boolean\", \"Date\", \"Object\"]}\r\n            },\r\n            \"IsKey\": {\r\n                \"id\": \"/items/properties/IsKey\",\r\n                \"type\": {\"enum\":[\"no\", \"yes\"]}\r\n            },\r\n            \"Indexed\": {\r\n                \"id\": \"/items/properties/Indexed\",\r\n                \"type\": {\"enum\":[\"no\", \"yes\"]}\r\n            }\r\n        },\r\n        \"type\": \"object\"\r\n    },\r\n    \"type\": \"array\"\r\n}"
                                            },
                                            "value": "[{\"Name\":\"ProjectID\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"Name\",\"Type\":\"String\",\"IsKey\":\"yes\",\"Indexed\":\"no\"},{\"Name\":\"Data\",\"Type\":\"Object\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"Status\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"LastModified\",\"Type\":\"Long\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"ErrorCode\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"},{\"Name\":\"ErrorMessage\",\"Type\":\"String\",\"IsKey\":\"no\",\"Indexed\":\"no\"}]"
                                        }
                                    ],
                                    "outputs": [],
                                    "inputs": [],
                                    "handler": {
                                        "settings": []
                                    },
                                    "reply": [],
                                    "s3Prefix": "flogo",
                                    "key": "flogo/GraphBuilder_Tools/connector/simpletable/connector.json",
                                    "display": {
                                        "description": "This is URL file reader",
                                        "category": "GraphBuilder_Tools",
                                        "visible": true,
                                        "smallIcon": "simpletable.png"
                                    },
                                    "actions": [
                                        {
                                            "name": "create",
                                            "display": {
                                                "name": "Create",
                                                "readonly": false,
                                                "valid": true,
                                                "visible": true
                                            }
                                        }
                                    ],
                                    "feature": {},
                                    "loopType": "none",
                                    "loopSettings": [],
                                    "retrySettings": [],
                                    "propertyMap": {},
                                    "keyfield": "name",
                                    "schemaMap": {},
                                    "iteratorAccumulate": false,
                                    "isValid": true,
                                    "lastUpdatedTime": 1636482504177,
                                    "user": "flogo",
                                    "connectorName": "AirTask",
                                    "connectorDescription": " "
                                },
                                "Method": "delete"
                            },
                            "input": {
                                "Mapping": {
                                    "mapping": {
                                        "ProjectID": "=$flow.ProjectID",
                                        "Name": "=$flow.Name"
                                    }
                                }
                            },
                            "output": {
                                "Exists": false
                            }
                        }
                    },
                    {
                        "id": "LogTaskExistsAndSuccessful",
                        "name": "LogTaskExistsAndSuccessful",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:BuildNdDeployAirPipeline RSVP1 %%%%% ProjectID : \", $flow.ProjectID, \", Name : \", $flow.Name, \", Successful: \", $flow.Successful, \", ErrorMsg : \", $flow.ErrorMsg, \", Data : \", coerce.toString($activity[TableMutate].Data.Old), \", Exist : \", $activity[TableMutate].Exists)"
                            }
                        }
                    },
                    {
                        "id": "DeployPipeline",
                        "name": "DeployPipeline",
                        "description": "Simple SubFlow Activity",
                        "activity": {
                            "ref": "#subflow",
                            "settings": {
                                "flowURI": "res://flow:Deploy_Model_Service"
                            },
                            "input": {
                                "ProjectID": "=$activity[TableMutate].Data.Old.ProjectID",
                                "Name": "=$activity[TableMutate].Data.Old.Name",
                                "Instance": "001",
                                "Method": "docker",
                                "SyncDeploy": false,
                                "ScriptSystemEnv": "=f1.getsubobject($activity[TableMutate].Data.Old.Data,\"ScriptSystemEnv\")",
                                "ModelDescriptor": {
                                    "mapping": {
                                        "dynamic": "=f1.json2object(\"{\\\"properties\\\":[]}\")",
                                        "extra": "=coerce.toArray(f1.getsubobject($activity[TableMutate].Data.Old.Data, \"Extra\"))"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "Return4",
                        "name": "Return4",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Success": true,
                                    "Message": "Action triggered!",
                                    "ErrorCode": 100
                                }
                            }
                        }
                    },
                    {
                        "id": "LogTaskNotFoundOrFail",
                        "name": "LogTaskNotFoundOrFail",
                        "description": "Simple Log Message Activity",
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:BuildNdDeployAirPipeline RSVP2 %%%%% ProjectID : \", $flow.ProjectID, \", Name : \", $flow.Name, \", Successful: \", $flow.Successful, \", ErrorMsg : \", $flow.ErrorMsg, \", Data : \", coerce.toString($activity[TableMutate].Data.Old), \", Exist : \", $activity[TableMutate].Exists)"
                            }
                        }
                    },
                    {
                        "id": "Return5",
                        "name": "Return5",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Success": true,
                                    "Message": "No matched action found!",
                                    "ErrorCode": 100
                                }
                            }
                        }
                    }
                ],
                "errorHandler": {
                    "tasks": [
                        {
                            "id": "Return3",
                            "name": "Return3",
                            "description": "Simple Return Activity",
                            "activity": {
                                "ref": "#actreturn",
                                "settings": {
                                    "mappings": {
                                        "Success": false,
                                        "ErrorCode": 400,
                                        "Message": "=$error.message"
                                    }
                                }
                            }
                        }
                    ],
                    "links": []
                },
                "metadata": {
                    "input": [
                        {
                            "name": "ProjectID",
                            "type": "string"
                        },
                        {
                            "name": "Name",
                            "type": "string"
                        },
                        {
                            "name": "Successful",
                            "type": "boolean"
                        },
                        {
                            "name": "ErrorMsg",
                            "type": "string"
                        }
                    ],
                    "output": [
                        {
                            "name": "Success",
                            "type": "boolean"
                        },
                        {
                            "name": "Message",
                            "type": "string"
                        },
                        {
                            "name": "ErrorCode",
                            "type": "float64"
                        }
                    ]
                },
                "explicitReply": true
            }
        },
        {
            "id": "flow:Create_Project",
            "data": {
                "name": "Create Project",
                "description": "",
                "links": [
                    {
                        "id": 1,
                        "from": "LogMessage",
                        "to": "SetSystemProperties",
                        "type": "default"
                    },
                    {
                        "id": 2,
                        "from": "SetSystemProperties",
                        "to": "CreateProjectFolder",
                        "type": "default"
                    },
                    {
                        "id": 3,
                        "from": "CreateProjectFolder",
                        "to": "SaveArtifacts",
                        "type": "default"
                    },
                    {
                        "id": 4,
                        "from": "SaveArtifacts",
                        "to": "ExecCommand",
                        "type": "default"
                    },
                    {
                        "id": 5,
                        "from": "ExecCommand",
                        "to": "ExtractDockerCompose",
                        "type": "default"
                    },
                    {
                        "id": 6,
                        "from": "ExtractDockerCompose",
                        "to": "Return1",
                        "type": "expression",
                        "label": "ExtractDockerCompose to Return",
                        "value": "0<array.count($activity[ExtractDockerCompose].Data)"
                    },
                    {
                        "id": 7,
                        "from": "ExtractDockerCompose",
                        "to": "Return2",
                        "type": "exprOtherwise",
                        "label": "ExtractDockerComposeto"
                    }
                ],
                "tasks": [
                    {
                        "id": "LogMessage",
                        "name": "LogMessage",
                        "description": "Simple Log Message Activity",
                        "type": "iterator",
                        "settings": {
                            "iterate": "=$flow.artifacts",
                            "accumulate": false
                        },
                        "activity": {
                            "ref": "#log",
                            "input": {
                                "Log Level": "INFO",
                                "flowInfo": false,
                                "message": "=string.concat(\"%%%%% ModelService:Create Project %%%%% Domain : \", $flow.ProjectID, \", artifact Type : \", $iteration[value].Type, \", artifact Name : \", $iteration[value].Name, \", Encoded : \", coerce.toString($iteration[value].Encoded))"
                            }
                        }
                    },
                    {
                        "id": "SetSystemProperties",
                        "name": "SetSystemProperties",
                        "description": "Mapping field from input to output",
                        "activity": {
                            "ref": "#mapping",
                            "settings": {
                                "IsArray": false,
                                "MappingFields": "[{\"Name\":\"ProjectsFolderInt\",\"Type\":\"String\"},{\"Name\":\"ProjectTemplateFolderInt\",\"Type\":\"String\"},{\"Name\":\"ProjectFolderInt\",\"Type\":\"String\"},{\"Name\":\"FolderMap\",\"Type\":\"Array\"}]"
                            },
                            "input": {
                                "Mapping": {
                                    "mapping": {
                                        "ProjectsFolderInt": "=$property[\"System.BaseFolder\"] + \"/projects\"",
                                        "ProjectTemplateFolderInt": "/home/project-template",
                                        "SkipCondition": false,
                                        "ProjectFolderInt": "=$property[\"System.BaseFolder\"] + \"/projects/\" + $flow.ProjectID",
                                        "FolderMap": "=f1.modelartifactmap($flow.artifacts)"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "CreateProjectFolder",
                        "name": "CreateProjectFolder",
                        "description": "This activity build docker image from Dockerfile",
                        "activity": {
                            "ref": "#exec",
                            "settings": {
                                "execConnection": "",
                                "workingFolder": "$ScriptsFolder$",
                                "numOfExecutions": 1,
                                "leftToken": "$",
                                "rightToken": "$",
                                "variablesDef": "[{\"Name\":\"ProjectsFolder\",\"Type\":\"String\"},{\"Name\":\"ProjectID\",\"Type\":\"String\"},{\"Name\":\"ProjectTemplateFolder\",\"Type\":\"String\"},{\"Name\":\"InternetAccess\",\"Type\":\"String\"},{\"Name\":\"ScriptsFolder\",\"Type\":\"String\"}]",
                                "SystemEnv": ""
                            },
                            "input": {
                                "Asynchronous": false,
                                "SkipCondition": false,
                                "Executable": {
                                    "mapping": {
                                        "Executions": {
                                            "Execution_0": "./create.sh $ProjectTemplateFolder$ $ProjectID$ $ProjectsFolder$ $InternetAccess$"
                                        }
                                    }
                                },
                                "Variables": {
                                    "mapping": {
                                        "ProjectsFolder": "=$activity[SetSystemProperties].Data.ProjectsFolderInt",
                                        "ProjectID": "=$flow.ProjectID",
                                        "ProjectTemplateFolder": "=$activity[SetSystemProperties].Data.ProjectTemplateFolderInt",
                                        "InternetAccess": "=coerce.toString($property[\"System.InternetAccess\"])",
                                        "ScriptsFolder": "/home/scripts"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "SaveArtifacts",
                        "name": "SaveArtifacts",
                        "description": "This activity write incoming object to file system",
                        "type": "iterator",
                        "settings": {
                            "iterate": "=$flow.artifacts",
                            "accumulate": false
                        },
                        "activity": {
                            "ref": "#filewriter",
                            "settings": {
                                "inputType": "String",
                                "outputFile": "$Filename$",
                                "leftToken": "$",
                                "rightToken": "$",
                                "variablesDef": "[{\"Name\":\"Filename\",\"Type\":\"String\"}]"
                            },
                            "input": {
                                "SkipCondition": "=false==$activity[CreateProjectFolder].Success||\"command\"==$iteration[value].Type||(\"folder\"==$iteration[value].Type&&false==string.endsWith(string.toLower($iteration[value].Name), \".zip\"))",
                                "Data": {
                                    "mapping": {
                                        "Input": "=$iteration[value].Value"
                                    }
                                },
                                "Variables": {
                                    "mapping": {
                                        "Filename": "=$activity[SetSystemProperties].Data.ProjectFolderInt + \"/artifacts/\" + $iteration[value].Name"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "ExecCommand",
                        "name": "ExecCommand",
                        "description": "This activity build docker image from Dockerfile",
                        "type": "iterator",
                        "settings": {
                            "iterate": "=$flow.artifacts",
                            "accumulate": false
                        },
                        "activity": {
                            "ref": "#exec",
                            "settings": {
                                "execConnection": "",
                                "workingFolder": "$WorkFolder$",
                                "numOfExecutions": 1,
                                "leftToken": "$",
                                "rightToken": "$",
                                "variablesDef": "[{\"Name\":\"WorkFolder\",\"Type\":\"String\"}]",
                                "SystemEnv": ""
                            },
                            "input": {
                                "Asynchronous": false,
                                "SkipCondition": "=(false==$activity[CreateProjectFolder].Success)||(\"command\"!=$iteration[value].Type)",
                                "Executable": {
                                    "mapping": {
                                        "Executions": {
                                            "Execution_0": "=$iteration[value].Value"
                                        }
                                    }
                                },
                                "Variables": {
                                    "mapping": {
                                        "WorkFolder": "=$activity[SetSystemProperties].Data.ProjectFolderInt + \"/artifacts/\""
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "ExtractDockerCompose",
                        "name": "ExtractDockerCompose",
                        "description": "Mapping field from input to output",
                        "type": "iterator",
                        "settings": {
                            "iterate": "=$flow.artifacts",
                            "accumulate": false
                        },
                        "activity": {
                            "ref": "#mapping",
                            "settings": {
                                "IsArray": true,
                                "MappingFields": "[{\"Name\":\"DockerCompose\",\"Type\":\"Array\"}]"
                            },
                            "input": {
                                "Mapping": {
                                    "mapping": {
                                        "ArraySize": "=array.count($flow.artifacts)",
                                        "SkipCondition": "=false == (\"descriptor\"==$iteration[value].Type && (\"docker-compose.yml\"==$iteration[value].Name||\"docker-compose.yaml\"==$iteration[value].Name))",
                                        "DockerCompose": "=f1.airymal2flogoproperties($iteration[value].Value)"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "id": "Return1",
                        "name": "Return1",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Success": "=$activity[CreateProjectFolder].Success",
                                    "ErrorCode": "=$activity[CreateProjectFolder].ErrorCode",
                                    "Extra": "=f1.combineproperties($activity[SetSystemProperties].Data.FolderMap, $activity[ExtractDockerCompose].Data[0].DockerCompose)"
                                }
                            }
                        }
                    },
                    {
                        "id": "Return2",
                        "name": "Return2",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "#actreturn",
                            "settings": {
                                "mappings": {
                                    "Success": "=$activity[CreateProjectFolder].Success",
                                    "ErrorCode": "=$activity[CreateProjectFolder].ErrorCode",
                                    "Extra": "=$activity[SetSystemProperties].Data.FolderMap"
                                }
                            }
                        }
                    }
                ],
                "metadata": {
                    "input": [
                        {
                            "name": "ProjectID",
                            "type": "string"
                        },
                        {
                            "name": "artifacts",
                            "type": "array",
                            "schema": {
                                "type": "json",
                                "value": "{\"type\":\"object\",\"properties\":{\"Type\":{\"type\":\"string\"},\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"},\"Encoded\":{\"type\":\"boolean\"}}}"
                            }
                        },
                        {
                            "name": "Properties",
                            "type": "object"
                        }
                    ],
                    "output": [
                        {
                            "name": "Success",
                            "type": "boolean"
                        },
                        {
                            "name": "Extra",
                            "type": "array",
                            "schema": {
                                "type": "json",
                                "value": "{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Value\":{\"type\":\"string\"}}}"
                            }
                        },
                        {
                            "name": "ErrorCode",
                            "type": "float64"
                        }
                    ]
                }
            }
        }
    ],
    "properties": [
        {
            "name": "System.ServiceLocatorIP",
            "type": "string",
            "value": "localhost"
        },
        {
            "name": "System.BaseFolder",
            "type": "string",
            "value": "/"
        },
        {
            "name": "System.FlogoBuilder",
            "type": "string",
            "value": "Flogo builder not set"
        },
        {
            "name": "System.BaseFolderExt",
            "type": "string",
            "value": "not set"
        },
        {
            "name": "System.BuilderURL",
            "type": "string",
            "value": "not set"
        },
        {
            "name": "System.DeployerURL",
            "type": "string",
            "value": "not set"
        },
        {
            "name": "Descriptor.docker",
            "type": "string",
            "value": "docker-compose.yml"
        },
        {
            "name": "Descriptor.k8s",
            "type": "string",
            "value": "deployment.yml"
        },
        {
            "name": "System.ExternalEndpointIP",
            "type": "string",
            "value": "not set"
        },
        {
            "name": "System.ServiceLocatorExternal",
            "type": "string",
            "value": "not set"
        },
        {
            "name": "System.InternetAccess",
            "type": "boolean",
            "value": true
        }
    ],
    "connections": {}
}